<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Contact Us | WabbleNews</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Montserrat Bold Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            background-color: #020204; 
            color: white; 
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            -webkit-font-smoothing: antialiased; 
            overflow-x: hidden; 
        }

        /* Mobile Menu */
        .mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            backdrop-filter: blur(20px);
            z-index: 9999;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .mobile-menu.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .mobile-menu-content { padding: 20px; height: 100%; display: flex; flex-direction: column; }
        .mobile-menu-close { align-self: flex-end; background: rgba(255, 255, 255, 0.1); border: none; border-radius: 12px; padding: 12px; color: white; cursor: pointer; }
        .mobile-menu-close:hover { background: rgba(255, 255, 255, 0.2); }
        .mobile-nav { display: flex; flex-direction: column; gap: 8px; margin-top: 40px; }
        .mobile-nav-link { padding: 16px 20px; color: white; text-decoration: none; font-weight: 700; font-size: 18px; border-radius: 12px; }
        .mobile-nav-link:hover, .mobile-nav-link.active { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
        .mobile-nav-link.signup-link { background: linear-gradient(135deg, #3b82f6, #2563eb); text-align: center; margin-top: 20px; }
        .mobile-profile-btn { display: flex; align-items: center; gap: 12px; padding: 16px 20px; color: white; font-weight: 700; font-size: 18px; border-radius: 12px; cursor: pointer; background: rgba(59, 130, 246, 0.2); margin-top: 20px; }
        .mobile-profile-btn.hidden { display: none; }

        /* Header */
        header {
            background: rgba(0, 0, 0, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Logo Container */
        .logo-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-circle {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 0 30px rgba(59, 130, 246, 0.5),
                0 0 60px rgba(59, 130, 246, 0.3),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(59, 130, 246, 0.5);
            overflow: hidden;
            position: relative;
        }

        .logo-circle::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            animation: logoShine 3s ease-in-out infinite;
        }

        @keyframes logoShine {
            0%, 100% { transform: rotate(0deg); opacity: 0.3; }
            50% { transform: rotate(180deg); opacity: 0.6; }
        }

        .logo-circle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            position: relative;
            z-index: 1;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 900;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text .blue {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Navigation */
        nav a {
            transition: color 0.2s ease;
            font-size: 14px;
            font-weight: 700;
        }

        nav a:hover {
            color: #60a5fa;
        }

        /* Advanced Contact Form */
        .contact-form {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            padding: 48px;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .contact-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .contact-form:hover::before {
            opacity: 1;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }

        .form-textarea {
            min-height: 180px;
            resize: vertical;
        }

        .submit-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 16px 40px;
            border: none;
            border-radius: 16px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.5);
        }

        .submit-btn:active {
            transform: translateY(-1px);
        }

        .test-btn {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            padding: 12px 32px;
            border: none;
            border-radius: 12px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-left: 12px;
        }

        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }

        .form-group {
            position: relative;
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            color: white;
            font-weight: 900;
            margin-bottom: 10px;
            font-size: 15px;
            position: relative;
            z-index: 1;
        }

        /* Sign Up Modal */
        .signup-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .signup-modal.active {
            display: flex;
        }

        .signup-content {
            background: rgba(15, 15, 25, 0.98);
            border: 2px solid rgba(59, 130, 246, 0.5);
            border-radius: 24px;
            padding: 40px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.3);
        }

        .signup-content h2 {
            font-weight: 900;
            font-size: 28px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #60a5fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .signup-content p {
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 24px;
        }

        .signup-content .form-group {
            margin-bottom: 20px;
        }

        .signup-content .form-group label {
            display: block;
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 8px;
            color: #e5e7eb;
        }

        .signup-content .form-group input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .signup-content .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.08);
        }

        .signup-content .form-group input.error {
            border-color: #ef4444;
        }

        .error-message {
            color: #ef4444;
            font-size: 12px;
            margin-top: 6px;
            font-weight: 700;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .signup-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 900;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
        }

        .signup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .signup-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .success-message {
            color: #22c55e;
            font-size: 14px;
            margin-top: 16px;
            font-weight: 700;
            text-align: center;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .toggle-link {
            color: #ffffff;
            font-size: 14px;
            font-weight: 700;
            text-align: center;
            margin-top: 16px;
        }

        .toggle-link .sign-in-link, .toggle-link .sign-up-link {
            color: #3b82f6;
            cursor: pointer;
            font-weight: 700;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .toggle-link .sign-in-link:hover, .toggle-link .sign-up-link:hover {
            color: #60a5fa;
            text-decoration: underline;
        }

        .signin-mode #signupForm {
            display: none;
        }

        .signup-mode #signinForm {
            display: none;
        }

        /* Profile Modal - Exact copy from index.html */
        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .profile-modal.active {
            display: flex;
        }

        .profile-content {
            background: rgba(15, 15, 25, 0.98);
            border: 2px solid rgba(59, 130, 246, 0.5);
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.3);
        }

        .profile-content h2 {
            font-weight: 900;
            font-size: 28px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #60a5fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .bio-textarea {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
            resize: vertical;
            min-height: 120px;
            max-height: 400px;
            overflow-y: auto;
            transition: border-color 0.3s ease;
        }

        .bio-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.08);
        }

        .bio-textarea::-webkit-resizer {
            background: rgba(59, 130, 246, 0.3);
            border-radius: 0 0 12px 0;
            cursor: ns-resize;
        }

        .profile-picture-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 24px;
        }

        .profile-picture-wrapper {
            position: relative;
            width: 130px;
            height: 130px;
            margin-bottom: 16px;
        }

        .profile-picture-preview {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.2);
            border: 4px solid rgba(59, 130, 246, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .profile-picture-preview::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #3b82f6);
            background-size: 200% 200%;
            animation: gradient-rotate 3s ease infinite;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        @keyframes gradient-rotate {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .profile-picture-preview:hover::before {
            opacity: 1;
        }

        .profile-picture-preview:hover {
            border-color: transparent;
            transform: scale(1.05);
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.4);
        }

        .profile-picture-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-picture-preview i {
            font-size: 48px;
            color: #60a5fa;
        }

        .profile-picture-edit-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: 3px solid #020204;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.5);
            z-index: 10;
        }

        .profile-picture-edit-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.7);
        }

        .profile-picture-edit-btn i {
            color: white;
        }

        .file-input-label {
            color: #60a5fa;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            padding: 8px 20px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            background: rgba(59, 130, 246, 0.1);
            transition: all 0.3s ease;
            display: inline-block;
        }

        .file-input-label:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .file-input-label:hover {
            color: #3b82f6;
        }

        #profilePictureInput {
            display: none;
        }

        #profilePictureError {
            margin-top: 8px;
        }

        .logout-btn {
            width: 100%;
            padding: 12px;
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.5);
            border-radius: 12px;
            color: #ef4444;
            font-weight: 900;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            border-color: #ef4444;
        }

        /* Profile Content Form Group - Match index.html exactly */
        .profile-content .form-group {
            margin-bottom: 20px;
        }

        .profile-content .form-group label {
            display: block;
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 8px;
            color: #e5e7eb;
        }

        .profile-content .form-group input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .profile-content .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.08);
        }

        .profile-content .form-group input.error {
            border-color: #ef4444;
        }

        .profile-content .form-group input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(255, 255, 255, 0.03);
        }

        /* Email Cards */
        .email-card {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 24px;
            padding: 32px;
            backdrop-filter: blur(20px);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }

        .email-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.7s ease;
        }

        .email-card:hover::before {
            left: 100%;
        }

        .email-card:hover {
            transform: translateY(-8px) scale(1.02);
        }

        .contact-card {
            border-color: rgba(59, 130, 246, 0.3);
        }

        .contact-card:hover {
            border-color: rgba(59, 130, 246, 1);
            background: rgba(59, 130, 246, 0.1);
            box-shadow: 
                0 25px 80px rgba(59, 130, 246, 0.5),
                0 0 60px rgba(59, 130, 246, 0.3),
                inset 0 0 40px rgba(59, 130, 246, 0.15);
        }

        .business-card {
            border-color: rgba(139, 92, 246, 0.3);
        }

        .business-card:hover {
            border-color: rgba(139, 92, 246, 1);
            background: rgba(139, 92, 246, 0.1);
            box-shadow: 
                0 25px 80px rgba(139, 92, 246, 0.5),
                0 0 60px rgba(139, 92, 246, 0.3),
                inset 0 0 40px rgba(139, 92, 246, 0.15);
        }

        .email-icon {
            width: 70px;
            height: 70px;
            border-radius: 18px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .business-icon {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }

        .email-card:hover .email-icon {
            transform: scale(1.15) rotate(5deg);
            filter: brightness(1.2);
        }

        .contact-card:hover .email-icon {
            box-shadow: 0 20px 50px rgba(59, 130, 246, 0.7);
        }

        .business-card:hover .email-icon {
            box-shadow: 0 20px 50px rgba(139, 92, 246, 0.7);
        }

        .email-title {
            font-size: 22px;
            font-weight: 900;
            color: white;
            margin-bottom: 8px;
        }

        .email-description {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .email-address {
            color: #60a5fa;
            font-size: 16px;
            font-weight: 900;
            transition: all 0.3s ease;
        }

        .email-card:hover .email-address {
            color: #93c5fd;
        }

        .business-card .email-address {
            color: #a78bfa;
        }

        .business-card:hover .email-address {
            color: #c4b5fd;
        }

        /* Contact Step System */
        .contact-step {
            display: none;
            animation: fadeSlideIn 0.4s ease;
        }

        .contact-step.active {
            display: block;
        }

        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Category Cards */
        .category-card {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 24px;
            padding: 32px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.7s ease;
        }

        .category-card:hover::before {
            left: 100%;
        }

        .category-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(59, 130, 246, 0.8);
            box-shadow: 0 25px 60px rgba(59, 130, 246, 0.4);
        }

        .category-card:active {
            transform: translateY(-4px) scale(0.98);
        }

        .category-card.business {
            border-color: rgba(139, 92, 246, 0.2);
        }

        .category-card.business:hover {
            border-color: rgba(139, 92, 246, 0.8);
            box-shadow: 0 25px 60px rgba(139, 92, 246, 0.4);
        }

        .category-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            transition: all 0.4s ease;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .category-card.business .category-icon {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }

        .category-card:hover .category-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .category-title {
            font-size: 22px;
            font-weight: 900;
            color: white;
            margin-bottom: 8px;
        }

        .category-desc {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .category-email {
            color: #60a5fa;
            font-size: 14px;
            font-weight: 800;
        }

        .category-card.business .category-email {
            color: #a78bfa;
        }

        /* Back Button */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #9ca3af;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 24px;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(-4px);
        }

        /* Selected Badge */
        .selected-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            color: #60a5fa;
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 24px;
        }

        .selected-badge.business {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
            color: #a78bfa;
        }

        /* Business Fields */
        .business-fields {
            display: none;
            animation: fadeSlideIn 0.4s ease;
        }

        .business-fields.active {
            display: block;
        }

        .optional {
            color: #6b7280;
            font-weight: 600;
        }

        /* Social Links Container */
        .social-links-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 16px;
        }

        .social-link-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #9ca3af;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .social-link-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(59, 130, 246, 0.5);
            color: white;
            transform: translateY(-2px);
        }

        .social-link-item.selected {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            color: #60a5fa;
        }

        .social-logo {
            width: 18px;
            height: 18px;
            border-radius: 4px;
        }

        .social-inputs {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .social-input-row {
            display: flex;
            align-items: center;
            gap: 12px;
            animation: fadeSlideIn 0.3s ease;
        }

        .social-input-row .social-logo {
            width: 24px;
            height: 24px;
        }

        .social-input-row input {
            flex: 1;
        }

        .social-input-row .remove-btn {
            padding: 8px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            color: #ef4444;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .social-input-row .remove-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .submit-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .category-card { padding: 24px; }
            .category-icon { width: 60px; height: 60px; }
            .category-title { font-size: 18px; }
            .social-links-container { gap: 8px; }
            .social-link-item { padding: 8px 12px; font-size: 12px; }
        }

        .website-hint {
            display: block;
            color: #ef4444;
            font-size: 12px;
            font-weight: 700;
            margin-top: 8px;
        }

        /* Custom Toast/Modal */
        .custom-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: linear-gradient(145deg, rgba(20, 20, 35, 0.98), rgba(10, 10, 20, 0.98));
            border-radius: 20px;
            padding: 32px 40px;
            max-width: 420px;
            width: 90%;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            text-align: center;
        }

        .custom-toast::before {
            content: '';
            position: absolute;
            inset: -1px;
            border-radius: 21px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #3b82f6);
            z-index: -1;
            opacity: 0.8;
        }

        .custom-toast::after {
            content: '';
            position: absolute;
            inset: 1px;
            border-radius: 19px;
            background: linear-gradient(145deg, rgba(20, 20, 35, 0.98), rgba(10, 10, 20, 0.98));
            z-index: -1;
        }

        .custom-toast.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .toast-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .toast-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .toast-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast-icon i { color: white; width: 28px; height: 28px; }

        .toast-title {
            font-size: 22px;
            font-weight: 900;
            color: white;
            margin-bottom: 12px;
        }

        .toast-message {
            color: #9ca3af;
            font-size: 14px;
            font-weight: 700;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .toast-message strong {
            color: #60a5fa;
        }

        .toast-btn {
            padding: 14px 40px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 800;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toast-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <!-- Header -->
    <header class="sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
            <!-- Logo -->
            <div class="logo-container cursor-pointer hover:opacity-90 transition-opacity" onclick="window.location.href='index.html'">
                <div class="logo-circle">
                    <img src="wabble.jpg" alt="WabbleNews Logo">
                </div>
                <span class="logo-text">Wabble<span class="blue">News</span></span>
            </div>

            <!-- Navigation -->
            <nav class="hidden lg:flex items-center gap-6">
                <a href="index.html" class="text-sm font-bold text-white">Home</a>
                <a href="contact.html" class="text-sm font-bold text-blue-400">Contact</a>
                <a href="social-media.html" class="text-sm font-bold text-white">Social Media</a>
                <a href="calendar.html" class="text-sm font-bold text-white">Calendar</a>
                <!-- Sign Up/Sign In Button (hidden when logged in) -->
                <a href="#" id="signUpBtn" onclick="openAuthModal('signup'); return false;" class="text-sm font-bold bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition-colors cursor-pointer">Sign Up/Sign In</a>
                <!-- Profile Button (hidden when logged out) -->
                <div id="profileBtn" class="hidden cursor-pointer" onclick="openProfileModal()">
                    <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center border-2 border-blue-400 overflow-hidden" id="headerProfilePicture">
                        <img id="headerProfileImg" src="" alt="Profile" style="display: none; width: 100%; height: 100%; object-fit: cover;">
                        <i data-lucide="user" id="headerProfileIcon" class="w-5 h-5 text-white"></i>
                    </div>
                </div>
            </nav>

            <!-- Mobile Menu Button -->
            <button onclick="toggleMenu()" class="lg:hidden p-2 rounded-lg hover:bg-white/10 text-white">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mobile-menu hidden">
        <div class="mobile-menu-content">
            <button onclick="toggleMenu()" class="mobile-menu-close">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <nav class="mobile-nav">
                <a href="index.html" class="mobile-nav-link">Home</a>
                <a href="contact.html" class="mobile-nav-link active">Contact</a>
                <a href="social-media.html" class="mobile-nav-link">Social Media</a>
                <a href="calendar.html" class="mobile-nav-link">Calendar</a>
                <a href="#" id="mobileSignUpBtn" onclick="openAuthModal('signup'); toggleMenu(); return false;" class="mobile-nav-link signup-link">Sign Up/Sign In</a>
                <div id="mobileProfileBtn" class="mobile-profile-btn hidden" onclick="openProfileModal(); toggleMenu();">
                    <i data-lucide="user" class="w-5 h-5"></i>
                    <span>Profile</span>
                </div>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow max-w-5xl mx-auto px-6 py-16 w-full">
        <div class="text-center mb-16">
            <h1 class="text-6xl font-black mb-6 bg-gradient-to-r from-white via-blue-300 to-purple-300 bg-clip-text text-transparent">
                Get In Touch
            </h1>
            <p class="text-gray-400 text-xl font-bold">
                Have a question or feedback? We'd love to hear from you
            </p>
        </div>

        <!-- Step 1: Category Selection -->
        <div id="step1" class="contact-step active">
            <h2 class="text-2xl font-black text-white text-center mb-8">How would you like to contact us?</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="category-card" onclick="selectCategory('general')">
                    <div class="category-icon">
                        <i data-lucide="mail" class="w-10 h-10 text-white"></i>
                    </div>
                    <h3 class="category-title">General Inquiries</h3>
                    <p class="category-desc">Questions, feedback, support requests</p>
                    <span class="category-email">contact@wabblenews.com</span>
                </div>
                <div class="category-card business" onclick="selectCategory('business')">
                    <div class="category-icon">
                        <i data-lucide="briefcase" class="w-10 h-10 text-white"></i>
                    </div>
                    <h3 class="category-title">Business Inquiries</h3>
                    <p class="category-desc">Partnerships, sponsorships, collaborations</p>
                    <span class="category-email">business@wabblenews.com</span>
                </div>
            </div>
        </div>

        <!-- Step 2: Contact Form -->
        <div id="step2" class="contact-step">
            <button class="back-btn" onclick="goBack()">
                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                <span>Back</span>
            </button>
            <div id="selectedCategoryBadge" class="selected-badge"></div>
            
            <div class="contact-form">
                <form id="contactForm" onsubmit="handleContactSubmit(event)">
                    <div class="form-group">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" id="name" name="name" class="form-input" placeholder="Your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" id="email" name="email" class="form-input" placeholder="your.email@example.com" required>
                    </div>

                    <!-- Business Fields (shown only for business category) -->
                    <div id="businessFields" class="business-fields">
                        <div class="form-group">
                            <label for="company" class="form-label">Company Name <span class="optional">(optional)</span></label>
                            <input type="text" id="company" name="company" class="form-input" placeholder="Your company name">
                        </div>
                        <div class="form-group">
                            <label for="website" class="form-label">Website <span class="optional">(optional)</span></label>
                            <input type="text" id="website" name="website" class="form-input" placeholder="https://yourwebsite.com" oninput="validateWebsite(this)">
                            <span class="website-hint">Use real website or normal website link</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Social Media <span class="optional">(optional)</span></label>
                            <div class="social-links-container">
                                <div class="social-link-item" onclick="toggleSocialInput('youtube')">
                                    <svg class="social-logo" viewBox="0 0 24 24" fill="#FF0000"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                                    <span>YouTube</span>
                                </div>
                                <div class="social-link-item" onclick="toggleSocialInput('twitter')">
                                    <svg class="social-logo" viewBox="0 0 24 24" fill="white"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                    <span>X (Twitter)</span>
                                </div>
                                <div class="social-link-item" onclick="toggleSocialInput('instagram')">
                                    <svg class="social-logo" viewBox="0 0 24 24"><defs><linearGradient id="ig-grad" x1="0%" y1="100%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#FFDC80"/><stop offset="25%" style="stop-color:#F77737"/><stop offset="50%" style="stop-color:#E1306C"/><stop offset="75%" style="stop-color:#C13584"/><stop offset="100%" style="stop-color:#833AB4"/></linearGradient></defs><path fill="url(#ig-grad)" d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                                    <span>Instagram</span>
                                </div>
                                <div class="social-link-item" onclick="toggleSocialInput('telegram')">
                                    <svg class="social-logo" viewBox="0 0 24 24" fill="#0088cc"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/></svg>
                                    <span>Telegram</span>
                                </div>
                                <div class="social-link-item" onclick="toggleSocialInput('linkedin')">
                                    <svg class="social-logo" viewBox="0 0 24 24" fill="#0A66C2"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                    <span>LinkedIn</span>
                                </div>
                            </div>
                            <div id="socialInputs" class="social-inputs"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="subject" class="form-label">Subject</label>
                        <input type="text" id="subject" name="subject" class="form-input" placeholder="What's this about?" required>
                    </div>
                    <div class="form-group">
                        <label for="message" class="form-label">Message</label>
                        <textarea id="message" name="message" class="form-textarea" placeholder="Tell us what's on your mind..." required></textarea>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="submit-btn">
                            <i data-lucide="send" class="w-5 h-5"></i>
                            <span>Send Message</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Custom Toast Modal -->
    <div class="toast-overlay" id="toastOverlay" onclick="closeToast()"></div>
    <div class="custom-toast" id="customToast">
        <div class="toast-icon">
            <i data-lucide="check"></i>
        </div>
        <h3 class="toast-title" id="toastTitle">Message Sent!</h3>
        <p class="toast-message" id="toastMessage"></p>
        <button class="toast-btn" onclick="closeToast()">OK</button>
    </div>

    <!-- Auth Modal (Sign Up/Sign In) -->
    <div id="authModal" class="signup-modal">
        <div class="signup-content relative signup-mode" id="authContent">
            <button class="close-btn" onclick="closeAuthModal()">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            <h2 id="authTitle">Join WabbleNews</h2>
            <p id="authSubtitle">Create your account to stay updated with the latest crypto news</p>
            
            <!-- Sign Up Form -->
            <form id="signupForm" onsubmit="handleSignUp(event)">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required autocomplete="username" placeholder="Choose a username" pattern="^[a-zA-Z0-9.]+$" minlength="3" maxlength="20">
                    <div class="error-message" id="usernameError"></div>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required autocomplete="new-password" placeholder="Create a secure password" minlength="8">
                    <div class="error-message" id="passwordError"></div>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required autocomplete="new-password" placeholder="Confirm your password" minlength="8">
                    <div class="error-message" id="confirmPasswordError"></div>
                </div>
                <button type="submit" class="signup-btn" id="signupSubmitBtn">Join Now</button>
                <div class="success-message" id="successMessage">Account created successfully! Welcome to WabbleNews!</div>
            </form>

            <!-- Sign In Form -->
            <form id="signinForm" onsubmit="handleSignIn(event)">
                <div class="form-group">
                    <label for="signinUsername">Username</label>
                    <input type="text" id="signinUsername" name="signinUsername" required autocomplete="username" placeholder="Enter your username">
                    <div class="error-message" id="signinUsernameError"></div>
                </div>
                <div class="form-group">
                    <label for="signinPassword">Password</label>
                    <input type="password" id="signinPassword" name="signinPassword" required autocomplete="current-password" placeholder="Enter your password">
                    <div class="error-message" id="signinPasswordError"></div>
                </div>
                <button type="submit" class="signup-btn" id="signinSubmitBtn">Sign In</button>
            </form>

            <!-- Toggle Links -->
            <div id="toggleToSignIn" class="toggle-link">
                Have an account? <span class="sign-in-link" onclick="switchToSignIn()">Sign in</span>
            </div>
            <div id="toggleToSignUp" class="toggle-link" style="display: none;">
                Don't have an account? <span class="sign-up-link" onclick="switchToSignUp()">Sign up</span>
            </div>
        </div>
    </div>

    <!-- Profile Modal - Exact copy from index.html -->
    <div id="profileModal" class="profile-modal">
        <div class="profile-content relative">
            <button class="close-btn" onclick="closeProfileModal()">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            <h2>Profile Settings</h2>
            <p style="margin-bottom: 24px; color: #9ca3af;">Customize your profile</p>
            
            <form id="profileForm" onsubmit="handleProfileUpdate(event)">
                <div class="profile-picture-container">
                    <div class="profile-picture-wrapper">
                        <div class="profile-picture-preview" onclick="document.getElementById('profilePictureInput').click()">
                            <img id="profilePicturePreview" src="" alt="Profile" style="display: none;">
                            <i data-lucide="user" id="profilePictureIcon"></i>
                        </div>
                        <div class="profile-picture-edit-btn" onclick="document.getElementById('profilePictureInput').click()">
                            <i data-lucide="pencil" class="w-4 h-4"></i>
                        </div>
                    </div>
                    <label for="profilePictureInput" class="file-input-label">Change Photo</label>
                    <input type="file" id="profilePictureInput" accept="image/png,image/jpeg,image/jpg,image/webp,image/gif" onchange="handleProfilePictureChange(event)">
                    <div class="error-message" id="profilePictureError"></div>
                </div>

                <div class="form-group">
                    <label for="profileUsername">Username</label>
                    <input 
                        type="text" 
                        id="profileUsername" 
                        name="profileUsername" 
                        placeholder="Enter your username"
                        maxlength="20"
                        pattern="^[a-zA-Z0-9.]+$"
                    >
                    <div class="error-message" id="usernameChangeError"></div>
                    <div style="margin-top: 4px;">
                        <span id="usernameChangeInfo" style="color: #9ca3af; font-size: 11px; font-weight: 700;"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="profileBio">Bio</label>
                    <div style="position: relative;">
                        <textarea 
                            id="profileBio" 
                            name="profileBio" 
                            placeholder="Tell us about yourself"
                            maxlength="500"
                            class="bio-textarea"
                        ></textarea>
                        <div style="text-align: right; margin-top: 6px;">
                            <span id="bioCharCount" style="color: #9ca3af; font-size: 12px; font-weight: 700;">0/500</span>
                        </div>
                    </div>
                </div>

                <button type="submit" class="signup-btn">Save Changes</button>
                <button type="button" class="logout-btn" onclick="handleLogout()">Log Out</button>
            </form>
        </div>
    </div>

    <script>
        lucide.createIcons();

        function toggleMenu() {
            const menu = document.getElementById('mobileMenu');
            if (menu) {
                menu.classList.toggle('hidden');
                document.body.style.overflow = menu.classList.contains('hidden') ? '' : 'hidden';
            }
            lucide.createIcons();
        }
        function updateMobileMenu() {
            const currentUser = localStorage.getItem('wabblenews_current_user');
            const mobileSignUp = document.getElementById('mobileSignUpBtn');
            const mobileProfile = document.getElementById('mobileProfileBtn');
            if (currentUser) {
                if (mobileSignUp) mobileSignUp.classList.add('hidden');
                if (mobileProfile) mobileProfile.classList.remove('hidden');
            } else {
                if (mobileSignUp) mobileSignUp.classList.remove('hidden');
                if (mobileProfile) mobileProfile.classList.add('hidden');
            }
        }

        let selectedCategory = null;
        const activeSocials = new Set();

        function selectCategory(category) {
            selectedCategory = category;
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step2').classList.add('active');
            
            const badge = document.getElementById('selectedCategoryBadge');
            const businessFields = document.getElementById('businessFields');
            
            if (category === 'business') {
                badge.className = 'selected-badge business';
                badge.innerHTML = '<i data-lucide="briefcase" class="w-4 h-4"></i> Business Inquiry';
                businessFields.classList.add('active');
            } else {
                badge.className = 'selected-badge';
                badge.innerHTML = '<i data-lucide="mail" class="w-4 h-4"></i> General Inquiry';
                businessFields.classList.remove('active');
            }
            lucide.createIcons();
        }

        function goBack() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step1').classList.add('active');
            selectedCategory = null;
        }

        function toggleSocialInput(platform) {
            const container = document.getElementById('socialInputs');
            const item = event.currentTarget;
            
            if (activeSocials.has(platform)) {
                activeSocials.delete(platform);
                item.classList.remove('selected');
                const row = document.getElementById('social-' + platform);
                if (row) row.remove();
            } else {
                activeSocials.add(platform);
                item.classList.add('selected');
                
                const logos = {
                    youtube: 'https://www.youtube.com/favicon.ico',
                    twitter: '<svg viewBox="0 0 24 24" fill="white"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>',
                    instagram: 'https://www.instagram.com/favicon.ico',
                    telegram: '<svg viewBox="0 0 24 24" fill="#0088cc"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/></svg>',
                    linkedin: 'https://www.linkedin.com/favicon.ico'
                };
                
                const placeholders = {
                    youtube: 'https://youtube.com/@yourchannel',
                    twitter: 'https://x.com/yourusername',
                    instagram: 'https://instagram.com/yourusername',
                    telegram: 'https://t.me/yourusername',
                    linkedin: 'https://linkedin.com/in/yourusername'
                };
                
                const row = document.createElement('div');
                row.className = 'social-input-row';
                row.id = 'social-' + platform;
                
                const logoHtml = logos[platform].startsWith('http') 
                    ? '<img src="' + logos[platform] + '" class="social-logo" alt="' + platform + '">'
                    : '<div class="social-logo" style="display:flex;align-items:center;justify-content:center;">' + logos[platform] + '</div>';
                
                row.innerHTML = logoHtml + 
                    '<input type="url" name="social_' + platform + '" class="form-input" placeholder="' + placeholders[platform] + '">' +
                    '<button type="button" class="remove-btn" onclick="removeSocialInput(\'' + platform + '\')"><i data-lucide="x" class="w-4 h-4"></i></button>';
                
                container.appendChild(row);
                lucide.createIcons();
            }
        }

        function removeSocialInput(platform) {
            activeSocials.delete(platform);
            const row = document.getElementById('social-' + platform);
            if (row) row.remove();
            document.querySelectorAll('.social-link-item').forEach(item => {
                if (item.textContent.toLowerCase().includes(platform === 'twitter' ? 'x' : platform)) {
                    item.classList.remove('selected');
                }
            });
        }

        function validateWebsite(input) {
            // No validation needed - just informational hint
        }

        function showToast(title, message) {
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastMessage').innerHTML = message;
            document.getElementById('toastOverlay').classList.add('active');
            document.getElementById('customToast').classList.add('active');
            lucide.createIcons();
        }

        function closeToast() {
            document.getElementById('toastOverlay').classList.remove('active');
            document.getElementById('customToast').classList.remove('active');
        }

        function handleContactSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const name = formData.get('name');
            const email = formData.get('email');
            const targetEmail = selectedCategory === 'business' ? 'business@wabblenews.com' : 'contact@wabblenews.com';
            
            showToast('Message Sent!', 'Thank you, <strong>' + name + '</strong>! Your message has been sent to <strong>' + targetEmail + '</strong>. We will get back to you at <strong>' + email + '</strong> soon.');
            
            form.reset();
            goBack();
            activeSocials.clear();
            document.getElementById('socialInputs').innerHTML = '';
            document.querySelectorAll('.social-link-item').forEach(item => item.classList.remove('selected'));
        }

        function checkLoginStatus() {
            if (!validateSession()) {
                const signUpBtn = document.getElementById('signUpBtn');
                const profileBtn = document.getElementById('profileBtn');
                if (signUpBtn) signUpBtn.classList.remove('hidden');
                if (profileBtn) profileBtn.classList.add('hidden');
                return;
            }
            const currentUser = localStorage.getItem('wabblenews_current_user');
            if (currentUser) {
                const signUpBtn = document.getElementById('signUpBtn');
                const profileBtn = document.getElementById('profileBtn');
                if (signUpBtn) signUpBtn.classList.add('hidden');
                if (profileBtn) profileBtn.classList.remove('hidden');
                loadProfileData();
            } else {
                const signUpBtn = document.getElementById('signUpBtn');
                const profileBtn = document.getElementById('profileBtn');
                if (signUpBtn) signUpBtn.classList.remove('hidden');
                if (profileBtn) profileBtn.classList.add('hidden');
            }
        }

        function validateSession() {
            const sessionData = localStorage.getItem('wabblenews_session_token');
            if (!sessionData) return false;
            try {
                const session = JSON.parse(sessionData);
                const expiresAt = new Date(session.expiresAt);
                if (expiresAt < new Date()) {
                    handleLogout();
                    return false;
                }
                return true;
            } catch (e) {
                return false;
            }
        }

        function openAuthModal(mode = 'signup') {
            const modal = document.getElementById('authModal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                if (mode === 'signin') {
                    switchToSignIn();
                } else {
                    switchToSignUp();
                }
                lucide.createIcons();
            }
        }

        function closeAuthModal() {
            const modal = document.getElementById('authModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
                const signupForm = document.getElementById('signupForm');
                const signinForm = document.getElementById('signinForm');
                const successMessage = document.getElementById('successMessage');
                if (signupForm) signupForm.reset();
                if (signinForm) signinForm.reset();
                if (successMessage) successMessage.classList.remove('show');
                clearAllErrors();
            }
        }

        function switchToSignIn() {
            const authContent = document.getElementById('authContent');
            const authTitle = document.getElementById('authTitle');
            const authSubtitle = document.getElementById('authSubtitle');
            const toggleToSignIn = document.getElementById('toggleToSignIn');
            const toggleToSignUp = document.getElementById('toggleToSignUp');
            if (authContent) {
                authContent.classList.remove('signup-mode');
                authContent.classList.add('signin-mode');
            }
            if (authTitle) authTitle.textContent = 'Welcome Back';
            if (authSubtitle) authSubtitle.textContent = 'Sign in to your account';
            if (toggleToSignIn) toggleToSignIn.style.display = 'none';
            if (toggleToSignUp) toggleToSignUp.style.display = 'block';
            clearAllErrors();
        }

        function switchToSignUp() {
            const authContent = document.getElementById('authContent');
            const authTitle = document.getElementById('authTitle');
            const authSubtitle = document.getElementById('authSubtitle');
            const toggleToSignIn = document.getElementById('toggleToSignIn');
            const toggleToSignUp = document.getElementById('toggleToSignUp');
            if (authContent) {
                authContent.classList.remove('signin-mode');
                authContent.classList.add('signup-mode');
            }
            if (authTitle) authTitle.textContent = 'Join WabbleNews';
            if (authSubtitle) authSubtitle.textContent = 'Create your account to stay updated with the latest crypto news';
            if (toggleToSignIn) toggleToSignIn.style.display = 'block';
            if (toggleToSignUp) toggleToSignUp.style.display = 'none';
            clearAllErrors();
        }

        function clearAllErrors() {
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('input').forEach(el => el.classList.remove('error'));
        }

        function validateUsername(username) {
            if (username.startsWith('_')) {
                return { valid: false, error: 'Username cannot start with underscore' };
            }
            if (!/^[a-zA-Z0-9.]+$/.test(username)) {
                return { valid: false, error: 'Username can only contain letters, numbers, and dots' };
            }
            if (/[_+?@#$%^&*()!]/.test(username)) {
                return { valid: false, error: 'Username cannot contain special characters like _, +, ?, etc.' };
            }
            if (username.length < 3) {
                return { valid: false, error: 'Username must be at least 3 characters' };
            }
            if (username.length > 20) {
                return { valid: false, error: 'Username must be less than 20 characters' };
            }
            return { valid: true };
        }

        function usernameExists(username) {
            const accounts = JSON.parse(localStorage.getItem('wabblenews_accounts') || '{}');
            return accounts.hasOwnProperty(username.toLowerCase());
        }

        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        function generateSessionToken() {
            const array = new Uint8Array(32);
            crypto.getRandomValues(array);
            return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
        }

        function createSession(username) {
            const token = generateSessionToken();
            const sessionData = {
                username: username.toLowerCase(),
                token: token,
                createdAt: new Date().toISOString(),
                expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
            };
            localStorage.setItem('wabblenews_session_token', JSON.stringify(sessionData));
            localStorage.setItem('wabblenews_current_user', username.toLowerCase());
            return token;
        }

        async function handleSignUp(event) {
            event.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const usernameError = document.getElementById('usernameError');
            const passwordError = document.getElementById('passwordError');
            const confirmPasswordError = document.getElementById('confirmPasswordError');
            const signupBtn = document.getElementById('signupSubmitBtn');
            const successMessage = document.getElementById('successMessage');
            
            clearAllErrors();
            if (successMessage) successMessage.classList.remove('show');
            
            const usernameValidation = validateUsername(username);
            if (!usernameValidation.valid) {
                if (usernameError) {
                    usernameError.textContent = usernameValidation.error;
                    usernameError.classList.add('show');
                }
                return;
            }
            
            if (usernameExists(username)) {
                if (usernameError) {
                    usernameError.textContent = 'Username already taken. Please choose another.';
                    usernameError.classList.add('show');
                }
                return;
            }
            
            if (password.length < 8) {
                if (passwordError) {
                    passwordError.textContent = 'Password must be at least 8 characters';
                    passwordError.classList.add('show');
                }
                return;
            }
            
            if (password !== confirmPassword) {
                if (confirmPasswordError) {
                    confirmPasswordError.textContent = 'Passwords do not match';
                    confirmPasswordError.classList.add('show');
                }
                return;
            }
            
            if (signupBtn) {
                signupBtn.disabled = true;
                signupBtn.textContent = 'Creating Account...';
            }
            
            try {
                const hashedPassword = await hashPassword(password);
                const accounts = JSON.parse(localStorage.getItem('wabblenews_accounts') || '{}');
                accounts[username.toLowerCase()] = {
                    username: username,
                    passwordHash: hashedPassword,
                    createdAt: new Date().toISOString(),
                    profile: { name: '', bio: '', picture: '' }
                };
                localStorage.setItem('wabblenews_accounts', JSON.stringify(accounts));
                createSession(username);
                checkLoginStatus();
                if (successMessage) successMessage.classList.add('show');
                if (signupBtn) signupBtn.textContent = 'Account Created!';
                setTimeout(() => {
                    closeAuthModal();
                }, 2000);
            } catch (error) {
                console.error('Error creating account:', error);
                if (passwordError) {
                    passwordError.textContent = 'An error occurred. Please try again.';
                    passwordError.classList.add('show');
                }
                if (signupBtn) {
                    signupBtn.disabled = false;
                    signupBtn.textContent = 'Join Now';
                }
            }
        }

        async function handleSignIn(event) {
            event.preventDefault();
            const username = document.getElementById('signinUsername').value.trim();
            const password = document.getElementById('signinPassword').value;
            const usernameError = document.getElementById('signinUsernameError');
            const passwordError = document.getElementById('signinPasswordError');
            const signinBtn = document.getElementById('signinSubmitBtn');
            
            clearAllErrors();
            
            if (!username) {
                if (usernameError) {
                    usernameError.textContent = 'Username is required';
                    usernameError.classList.add('show');
                }
                return;
            }
            
            if (!password) {
                if (passwordError) {
                    passwordError.textContent = 'Password is required';
                    passwordError.classList.add('show');
                }
                return;
            }
            
            if (!usernameExists(username)) {
                if (usernameError) {
                    usernameError.textContent = 'Username not found';
                    usernameError.classList.add('show');
                }
                return;
            }
            
            if (signinBtn) {
                signinBtn.disabled = true;
                signinBtn.textContent = 'Signing In...';
            }
            
            try {
                const hashedPassword = await hashPassword(password);
                const accounts = JSON.parse(localStorage.getItem('wabblenews_accounts') || '{}');
                const account = accounts[username.toLowerCase()];
                
                if (!account || account.passwordHash !== hashedPassword) {
                    if (passwordError) {
                        passwordError.textContent = 'Incorrect password';
                        passwordError.classList.add('show');
                    }
                    if (signinBtn) {
                        signinBtn.disabled = false;
                        signinBtn.textContent = 'Sign In';
                    }
                    return;
                }
                
                createSession(username);
                checkLoginStatus();
                if (signinBtn) {
                    signinBtn.textContent = 'Success!';
                    signinBtn.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                }
                setTimeout(() => {
                    closeAuthModal();
                    if (signinBtn) {
                        signinBtn.textContent = 'Sign In';
                        signinBtn.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
                    }
                }, 1000);
            } catch (error) {
                console.error('Error signing in:', error);
                if (passwordError) {
                    passwordError.textContent = 'An error occurred. Please try again.';
                    passwordError.classList.add('show');
                }
                if (signinBtn) {
                    signinBtn.disabled = false;
                    signinBtn.textContent = 'Sign In';
                }
            }
        }

        function openProfileModal() {
            const modal = document.getElementById('profileModal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                loadProfileData();
                lucide.createIcons();
                setTimeout(() => {
                    updateBioCharCount();
                }, 100);
            }
        }

        function closeProfileModal() {
            const modal = document.getElementById('profileModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function loadProfileData() {
            const currentUser = localStorage.getItem('wabblenews_current_user');
            if (!currentUser) return;
            const accounts = JSON.parse(localStorage.getItem('wabblenews_accounts') || '{}');
            const account = accounts[currentUser];
            if (account) {
                const usernameInput = document.getElementById('profileUsername');
                if (usernameInput) {
                    usernameInput.value = account.username || currentUser;
                }
                checkUsernameChangeCooldown(account);
                if (account.profile) {
                    const bio = document.getElementById('profileBio');
                    if (bio) bio.value = account.profile.bio || '';
                    updateBioCharCount();
                    const preview = document.getElementById('profilePicturePreview');
                    const icon = document.getElementById('profilePictureIcon');
                    if (account.profile.picture) {
                        if (preview) {
                            preview.src = account.profile.picture;
                            preview.style.display = 'block';
                        }
                        if (icon) icon.style.display = 'none';
                    } else {
                        if (preview) preview.style.display = 'none';
                        if (icon) icon.style.display = 'block';
                    }
                } else {
                    const bio = document.getElementById('profileBio');
                    if (bio) bio.value = '';
                    const preview = document.getElementById('profilePicturePreview');
                    const icon = document.getElementById('profilePictureIcon');
                    if (preview) preview.style.display = 'none';
                    if (icon) icon.style.display = 'block';
                    updateBioCharCount();
                }
                updateHeaderProfilePicture(account.profile?.picture);
            }
        }

        function checkUsernameChangeCooldown(account) {
            const usernameInput = document.getElementById('profileUsername');
            const errorDiv = document.getElementById('usernameChangeError');
            const infoDiv = document.getElementById('usernameChangeInfo');
            if (!account.usernameLastChanged) {
                if (infoDiv) {
                    infoDiv.textContent = 'You can change your username';
                    infoDiv.style.color = '#22c55e';
                }
                if (usernameInput) usernameInput.disabled = false;
                return true;
            }
            const lastChanged = new Date(account.usernameLastChanged);
            const now = new Date();
            const daysSinceChange = (now - lastChanged) / (1000 * 60 * 60 * 24);
            const daysRemaining = Math.ceil(7 - daysSinceChange);
            if (daysSinceChange >= 7) {
                if (infoDiv) {
                    infoDiv.textContent = 'You can change your username';
                    infoDiv.style.color = '#22c55e';
                }
                if (usernameInput) usernameInput.disabled = false;
                return true;
            } else {
                if (infoDiv) {
                    infoDiv.textContent = `Username can be changed in ${daysRemaining} day${daysRemaining !== 1 ? 's' : ''}`;
                    infoDiv.style.color = '#ef4444';
                }
                if (usernameInput) {
                    usernameInput.disabled = true;
                    usernameInput.style.opacity = '0.5';
                    usernameInput.style.cursor = 'not-allowed';
                }
                return false;
            }
        }

        function updateHeaderProfilePicture(pictureUrl) {
            const headerImg = document.getElementById('headerProfileImg');
            const headerIcon = document.getElementById('headerProfileIcon');
            if (pictureUrl) {
                if (headerImg) {
                    headerImg.src = pictureUrl;
                    headerImg.style.display = 'block';
                }
                if (headerIcon) headerIcon.style.display = 'none';
            } else {
                if (headerImg) headerImg.style.display = 'none';
                if (headerIcon) headerIcon.style.display = 'block';
            }
        }

        function updateBioCharCount() {
            const bio = document.getElementById('profileBio');
            const charCount = document.getElementById('bioCharCount');
            if (bio && charCount) {
                const length = bio.value.length;
                charCount.textContent = `${length}/500`;
                charCount.style.color = length > 450 ? '#ef4444' : '#9ca3af';
            }
        }

        function handleProfilePictureChange(event) {
            const file = event.target.files[0];
            const errorDiv = document.getElementById('profilePictureError');
            if (errorDiv) {
                errorDiv.classList.remove('show');
                errorDiv.textContent = '';
            }
            if (!file) return;
            const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/webp', 'image/gif'];
            const fileExtension = file.name.split('.').pop().toLowerCase();
            const allowedExtensions = ['png', 'jpg', 'jpeg', 'webp', 'gif'];
            if (!allowedTypes.includes(file.type) || !allowedExtensions.includes(fileExtension)) {
                if (errorDiv) {
                    errorDiv.textContent = 'Only PNG, JPG, JPEG, WEBP, and GIF images are allowed';
                    errorDiv.classList.add('show');
                }
                event.target.value = '';
                return;
            }
            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                if (errorDiv) {
                    errorDiv.textContent = 'Image size must be less than 5MB';
                    errorDiv.classList.add('show');
                }
                event.target.value = '';
                return;
            }
            const validationReader = new FileReader();
            validationReader.onload = function(validationEvent) {
                const arrayBuffer = validationEvent.target.result;
                const bytes = new Uint8Array(arrayBuffer);
                let isValidImage = false;
                if (bytes[0] === 0x89 && bytes[1] === 0x50 && bytes[2] === 0x4E && bytes[3] === 0x47) {
                    isValidImage = true;
                } else if (bytes[0] === 0xFF && bytes[1] === 0xD8 && bytes[2] === 0xFF) {
                    isValidImage = true;
                } else if (bytes[0] === 0x47 && bytes[1] === 0x49 && bytes[2] === 0x46 && bytes[3] === 0x38) {
                    isValidImage = true;
                } else if (bytes[0] === 0x52 && bytes[1] === 0x49 && bytes[2] === 0x46 && bytes[3] === 0x46) {
                    const str = String.fromCharCode.apply(null, bytes.slice(8, 12));
                    if (str === 'WEBP') {
                        isValidImage = true;
                    }
                }
                if (!isValidImage) {
                    if (errorDiv) {
                        errorDiv.textContent = 'Invalid image file. Only PNG, JPG, WEBP, and GIF are allowed';
                        errorDiv.classList.add('show');
                    }
                    event.target.value = '';
                    return;
                }
                const previewReader = new FileReader();
                previewReader.onload = function(previewEvent) {
                    const imageUrl = previewEvent.target.result;
                    const preview = document.getElementById('profilePicturePreview');
                    const icon = document.getElementById('profilePictureIcon');
                    if (preview) {
                        preview.src = imageUrl;
                        preview.style.display = 'block';
                    }
                    if (icon) icon.style.display = 'none';
                };
                previewReader.onerror = function() {
                    if (errorDiv) {
                        errorDiv.textContent = 'Error reading file. Please try again.';
                        errorDiv.classList.add('show');
                    }
                };
                previewReader.readAsDataURL(file);
            };
            validationReader.onerror = function() {
                if (errorDiv) {
                    errorDiv.textContent = 'Error validating file. Please try again.';
                    errorDiv.classList.add('show');
                }
            };
            validationReader.readAsArrayBuffer(file);
        }

        function handleProfileUpdate(event) {
            event.preventDefault();
            
            let currentUser = localStorage.getItem('wabblenews_current_user');
            if (!currentUser) {
                alert('You must be logged in to update your profile');
                return;
            }
            
            const accounts = JSON.parse(localStorage.getItem('wabblenews_accounts') || '{}');
            let account = accounts[currentUser];
            
            if (!account) {
                alert('Account not found');
                return;
            }
            
            const usernameError = document.getElementById('usernameChangeError');
            const usernameInput = document.getElementById('profileUsername');
            
            const newUsername = usernameInput ? usernameInput.value.trim() : '';
            const currentUsername = account.username || currentUser;
            
            if (newUsername && newUsername !== currentUsername) {
                if (!checkUsernameChangeCooldown(account)) {
                    if (usernameError) {
                        usernameError.textContent = 'Username can only be changed once per week';
                        usernameError.classList.add('show');
                    }
                    if (usernameInput) usernameInput.classList.add('error');
                    return;
                }
                const usernameValidation = validateUsername(newUsername);
                if (!usernameValidation.valid) {
                    if (usernameError) {
                        usernameError.textContent = usernameValidation.error;
                        usernameError.classList.add('show');
                    }
                    if (usernameInput) usernameInput.classList.add('error');
                    return;
                }
                if (usernameExists(newUsername) && newUsername.toLowerCase() !== currentUser.toLowerCase()) {
                    if (usernameError) {
                        usernameError.textContent = 'Username already taken';
                        usernameError.classList.add('show');
                    }
                    if (usernameInput) usernameInput.classList.add('error');
                    return;
                }
                const oldUsername = currentUser;
                const newUsernameLower = newUsername.toLowerCase();
                account.username = newUsername;
                account.usernameLastChanged = new Date().toISOString();
                if (oldUsername !== newUsernameLower) {
                    accounts[newUsernameLower] = account;
                    delete accounts[oldUsername];
                    localStorage.setItem('wabblenews_current_user', newUsernameLower);
                    currentUser = newUsernameLower;
                }
            }
            
            const picturePreview = document.getElementById('profilePicturePreview');
            let pictureUrl = account.profile?.picture || '';
            
            if (picturePreview) {
                const pictureSrc = picturePreview.src;
                if (pictureSrc && pictureSrc.startsWith('data:image')) {
                    pictureUrl = pictureSrc;
                } else if (pictureSrc && pictureSrc.startsWith('blob:')) {
                    pictureUrl = pictureSrc;
                } else if (pictureSrc && pictureSrc.length > 0 && pictureSrc !== '') {
                    if (picturePreview.style.display !== 'none') {
                        pictureUrl = pictureSrc;
                    }
                }
            }
            
            if (!account.profile) account.profile = {};
            const bioElement = document.getElementById('profileBio');
            account.profile.bio = bioElement ? bioElement.value.trim() : '';
            account.profile.picture = pictureUrl;
            
            accounts[currentUser.toLowerCase()] = account;
            localStorage.setItem('wabblenews_accounts', JSON.stringify(accounts));
            
            updateHeaderProfilePicture(pictureUrl);
            if (usernameError) usernameError.classList.remove('show');
            if (usernameInput) usernameInput.classList.remove('error');
            const btn = event.target.querySelector('button[type="submit"]');
            if (btn) {
                const originalText = btn.textContent;
                btn.textContent = 'Saved!';
                btn.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                setTimeout(() => {
                    closeProfileModal();
                    checkLoginStatus();
                    btn.textContent = originalText;
                    btn.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
                }, 1000);
            } else {
                alert('Profile saved successfully!');
                closeProfileModal();
                checkLoginStatus();
            }
        }

        function handleLogout() {
            localStorage.removeItem('wabblenews_current_user');
            localStorage.removeItem('wabblenews_session_token');
            checkLoginStatus();
            closeProfileModal();
            switchToSignUp();
            const signupForm = document.getElementById('signupForm');
            const signinForm = document.getElementById('signinForm');
            if (signupForm) signupForm.reset();
            if (signinForm) signinForm.reset();
            clearAllErrors();
        }

        const profileBio = document.getElementById('profileBio');
        if (profileBio) {
            profileBio.addEventListener('input', updateBioCharCount);
        }

        document.getElementById('authModal')?.addEventListener('click', function(e) {
            if (e.target === this) closeAuthModal();
        });

        document.getElementById('profileModal')?.addEventListener('click', function(e) {
            if (e.target === this) closeProfileModal();
        });

        checkLoginStatus();
        updateMobileMenu();
        setInterval(() => {
            if (localStorage.getItem('wabblenews_current_user')) {
                if (!validateSession()) {
                    checkLoginStatus();
                    updateMobileMenu();
                }
            }
        }, 60000);
    </script>

    <!-- Footer -->
    <footer class="border-t border-white/10 bg-black py-10 mt-auto">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <div class="flex flex-wrap justify-center gap-4 mb-4">
                <a href="terms-of-use.html" class="text-gray-400 hover:text-white text-xs font-bold transition-colors">Terms of Use</a>
                <span class="text-gray-600"></span>
                <a href="terms-of-service.html" class="text-gray-400 hover:text-white text-xs font-bold transition-colors">Terms of Service</a>
            </div>
            <p class="text-gray-500 text-xs font-bold mt-2">Copyright  2025 Wabble News / Crypto Wabble. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
