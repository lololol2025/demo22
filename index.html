<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WabbleNews | Premium Crypto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Montserrat Bold Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            background-color: #020204; 
            color: white; 
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            -webkit-font-smoothing: antialiased; 
            overflow-x: hidden; 
        }

        /* Header */
        header {
            background: rgba(0, 0, 0, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Logo Container */
        .logo-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-circle {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 0 30px rgba(59, 130, 246, 0.5),
                0 0 60px rgba(59, 130, 246, 0.3),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(59, 130, 246, 0.5);
            overflow: hidden;
            position: relative;
        }

        .logo-circle::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            animation: logoShine 3s ease-in-out infinite;
        }

        @keyframes logoShine {
            0%, 100% { transform: rotate(0deg); opacity: 0.3; }
            50% { transform: rotate(180deg); opacity: 0.6; }
        }

        .logo-circle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            position: relative;
            z-index: 1;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 900;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text .blue {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Ticker Container */
        .ticker-wrapper {
            width: 100%;
            overflow: hidden;
            background: rgba(5, 5, 10, 0.98);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            height: 100px;
            position: relative;
            display: flex;
            align-items: center;
        }


        @media (max-width: 768px) {
            .ticker-wrapper {
                height: 90px;
            }
            
            .coin-pill {
                min-width: 240px;
                padding: 10px 16px;
                gap: 12px;
            }
            
            .coin-icon {
                width: 36px;
                height: 36px;
            }
            
            .coin-symbol {
                font-size: 15px;
            }
            
            .coin-price {
                font-size: 13px;
            }
            
            .coin-change {
                font-size: 12px;
            }
        }

        .ticker-container {
            display: flex;
            width: max-content;
            animation: scroll 35s linear infinite;
            gap: 1.5rem;
            will-change: transform;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        .ticker-wrapper:hover .ticker-container {
            animation-play-state: paused;
        }

        /* Smooth fade-in for coin pills */
        .coin-pill {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px) translateZ(0);
            }
            to {
                opacity: 1;
                transform: translateY(0) translateZ(0);
            }
        }

        /* Loading spinner animation */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes scroll {
            0% { transform: translateX(0) translateZ(0); }
            100% { transform: translateX(-50%) translateZ(0); }
        }

        /* Coin Pills - Advanced Styling */
        .coin-pill {
            display: flex;
            align-items: center;
            gap: 14px;
            background: transparent;
            border-radius: 50px;
            padding: 12px 20px;
            min-width: 280px;
            flex-shrink: 0;
            transition: border-color 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        /* Persistent Green Glow for Price Up */
        .coin-pill.price-up {
            border: 3px solid #22c55e;
            background: transparent;
        }

        /* Persistent Red Glow for Price Down */
        .coin-pill.price-down {
            border: 3px solid #ef4444;
            background: transparent;
        }

        .coin-pill:hover {
            transform: translateY(-2px);
        }

        .coin-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px;
            flex-shrink: 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .coin-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
            filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.3));
        }

        .coin-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
            min-width: 0;
        }

        .coin-symbol-price {
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        .coin-symbol {
            font-weight: 900;
            font-size: 17px;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1;
        }

        .coin-price {
            font-weight: 900;
            font-size: 16px;
            color: #ffffff;
            font-family: 'Montserrat', sans-serif;
            line-height: 1;
            transition: color 0.3s ease;
            backface-visibility: hidden;
            letter-spacing: 0.3px;
        }


        @keyframes priceHighlightUp {
            0% { 
                color: #ffffff;
            }
            50% { 
                color: #22c55e;
            }
            100% { 
                color: #ffffff;
            }
        }

        @keyframes priceHighlightDown {
            0% { 
                color: #ffffff;
            }
            50% { 
                color: #ef4444;
            }
            100% { 
                color: #ffffff;
            }
        }

        .coin-pill.highlight-border-up {
            animation: borderPulseGreen 0.8s ease-out;
        }

        .coin-pill.highlight-border-down {
            animation: borderPulseRed 0.8s ease-out;
        }

        .coin-price.highlight-up {
            animation: priceHighlightUp 0.8s ease-out;
        }

        .coin-price.highlight-down {
            animation: priceHighlightDown 0.8s ease-out;
        }

        @keyframes borderPulseGreen {
            0% { 
                box-shadow: 0 0 0px rgba(34, 197, 94, 0);
            }
            50% { 
                box-shadow: 0 0 8px rgba(34, 197, 94, 0.4);
            }
            100% { 
                box-shadow: 0 0 0px rgba(34, 197, 94, 0);
            }
        }

        @keyframes borderPulseRed {
            0% { 
                box-shadow: 0 0 0px rgba(239, 68, 68, 0);
            }
            50% { 
                box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);
            }
            100% { 
                box-shadow: 0 0 0px rgba(239, 68, 68, 0);
            }
        }

        .coin-change {
            font-weight: 900;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
            line-height: 1;
        }

        .coin-change.up {
            color: #22c55e;
        }

        .coin-change.down {
            color: #ef4444;
        }

        /* Navigation */
        nav a {
            transition: color 0.2s ease;
            font-size: 14px;
            font-weight: 700;
        }

        nav a:hover {
            color: #60a5fa;
        }

        /* Content */
        .news-section h1 {
            font-weight: 900;
            font-size: clamp(2.5rem, 5vw, 4rem);
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        .news-section p {
            color: #9ca3af;
            font-size: clamp(1rem, 2vw, 1.25rem);
            margin-top: 8px;
            font-weight: 700;
        }

        /* Smooth scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Sign Up Modal */
        .signup-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .signup-modal.active {
            display: flex;
            opacity: 1;
        }

        .signup-content {
            background: linear-gradient(145deg, rgba(20, 20, 35, 0.98), rgba(10, 10, 20, 0.98));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 28px;
            padding: 48px;
            max-width: 460px;
            width: 90%;
            box-shadow: 
                0 0 80px rgba(59, 130, 246, 0.25),
                0 25px 60px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            transform: translateY(20px) scale(0.95);
            animation: modalSlideIn 0.5s ease forwards;
        }

        @keyframes modalSlideIn {
            to { transform: translateY(0) scale(1); }
        }

        .signup-content::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 30px;
            background: linear-gradient(135deg, #09B1F8, #0088cc, #09B1F8, #0077b5);
            background-size: 300% 300%;
            z-index: -1;
            animation: borderGradient 4s ease infinite;
            opacity: 0.9;
        }

        .signup-content::after {
            content: '';
            position: absolute;
            inset: 1px;
            border-radius: 27px;
            background: linear-gradient(145deg, rgba(20, 20, 35, 0.99), rgba(10, 10, 20, 0.99));
            z-index: -1;
        }

        @keyframes borderGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .signup-content h2 {
            font-weight: 900;
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ffffff 0%, #60a5fa 50%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
        }

        .signup-content p {
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 28px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 8px;
            color: #e5e7eb;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.08);
        }

        .form-group input.error {
            border-color: #ef4444;
        }

        .form-group input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(255, 255, 255, 0.03);
        }

        .error-message {
            color: #ef4444;
            font-size: 12px;
            margin-top: 6px;
            font-weight: 700;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .signup-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 900;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
        }

        .signup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .signup-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .success-message {
            color: #22c55e;
            font-size: 14px;
            margin-top: 16px;
            font-weight: 700;
            text-align: center;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .toggle-link {
            color: #ffffff;
            font-size: 14px;
            font-weight: 700;
            text-align: center;
            margin-top: 16px;
        }

        .toggle-link .sign-in-link {
            color: #3b82f6;
            cursor: pointer;
            font-weight: 700;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .toggle-link .sign-in-link:hover {
            color: #60a5fa;
            text-decoration: underline;
        }

        .toggle-link .sign-up-link {
            color: #3b82f6;
            cursor: pointer;
            font-weight: 700;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .toggle-link .sign-up-link:hover {
            color: #60a5fa;
            text-decoration: underline;
        }

        /* Google Sign-In Button */
        .google-btn {
            width: 100%;
            padding: 16px 20px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: none;
            border-radius: 14px;
            color: #1f2937;
            font-weight: 800;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .google-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .google-btn:hover::before {
            left: 100%;
        }

        .google-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(255, 255, 255, 0.15);
        }

        .google-btn:active {
            transform: translateY(-1px);
        }

        .google-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .google-btn svg {
            width: 22px;
            height: 22px;
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 24px 0;
            gap: 16px;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
        }

        .divider span {
            color: #6b7280;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .signin-mode #signupForm {
            display: none;
        }

        .signup-mode #signinForm {
            display: none;
        }

        /* Profile Modal */
        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .profile-modal.active {
            display: flex;
        }

        .profile-content {
            background: rgba(15, 15, 25, 0.98);
            border: 2px solid rgba(59, 130, 246, 0.5);
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.3);
        }

        .profile-content h2 {
            font-weight: 900;
            font-size: 28px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #60a5fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .bio-textarea {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
            resize: vertical;
            min-height: 120px;
            max-height: 400px;
            overflow-y: auto;
            transition: border-color 0.3s ease;
        }

        .bio-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.08);
        }

        .bio-textarea::-webkit-resizer {
            background: rgba(59, 130, 246, 0.3);
            border-radius: 0 0 12px 0;
            cursor: ns-resize;
        }

        .profile-picture-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 24px;
        }

        .profile-picture-wrapper {
            position: relative;
            width: 130px;
            height: 130px;
            margin-bottom: 16px;
        }

        .profile-picture-preview {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.2);
            border: 4px solid rgba(59, 130, 246, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .profile-picture-preview::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #3b82f6);
            background-size: 200% 200%;
            animation: gradient-rotate 3s ease infinite;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        @keyframes gradient-rotate {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .profile-picture-preview:hover::before {
            opacity: 1;
        }

        .profile-picture-preview:hover {
            border-color: transparent;
            transform: scale(1.05);
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.4);
        }

        .profile-picture-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-picture-preview i {
            font-size: 48px;
            color: #60a5fa;
        }

        .profile-picture-edit-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: 3px solid #020204;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.5);
            z-index: 10;
        }

        .profile-picture-edit-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.7);
        }

        .profile-picture-edit-btn i {
            color: white;
        }

        .file-input-label {
            color: #60a5fa;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            padding: 8px 20px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            background: rgba(59, 130, 246, 0.1);
            transition: all 0.3s ease;
            display: inline-block;
        }

        .file-input-label:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        #profilePictureInput {
            display: none;
        }

        #profilePictureError {
            margin-top: 8px;
        }

        .logout-btn {
            width: 100%;
            padding: 12px;
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.5);
            border-radius: 12px;
            color: #ef4444;
            font-weight: 900;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            border-color: #ef4444;
        }

        /* News Card Styles */
        .news-card {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }

        .news-card:hover {
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-6px);
            box-shadow: 0 20px 50px rgba(59, 130, 246, 0.2);
        }

        .news-card-media {
            position: relative;
            width: 100%;
            overflow: hidden;
        }

        .media-grid {
            display: grid;
            gap: 2px;
            width: 100%;
        }

        .media-grid.grid-1 { grid-template-columns: 1fr; }
        .media-grid.grid-2 { grid-template-columns: 1fr 1fr; }
        .media-grid.grid-3 { grid-template-columns: 2fr 1fr; grid-template-rows: 1fr 1fr; }
        .media-grid.grid-3 .media-item:first-child { grid-row: span 2; }
        .media-grid.grid-4 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }

        .media-item {
            position: relative;
            overflow: hidden;
            background: #111;
        }

        .media-item img, .media-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .news-card:hover .media-item img,
        .news-card:hover .media-item video {
            transform: scale(1.05);
        }

        .media-grid.grid-1 .media-item { height: 280px; }
        .media-grid.grid-2 .media-item { height: 200px; }
        .media-grid.grid-3 .media-item { height: 140px; }
        .media-grid.grid-3 .media-item:first-child { height: 282px; }
        .media-grid.grid-4 .media-item { height: 140px; }

        .video-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .video-indicator i { color: white; }

        .news-card-content {
            padding: 16px 20px 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .news-card-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .news-card-date {
            color: #9ca3af;
            font-size: 12px;
            font-weight: 700;
        }

        .news-card-time {
            color: #60a5fa;
            font-size: 12px;
            font-weight: 700;
        }

        .news-card-title {
            color: white;
            font-size: 15px;
            font-weight: 800;
            line-height: 1.5;
            flex-grow: 1;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            line-clamp: 4;
        }

        .news-card-no-image .news-card-title {
            font-size: 17px;
            -webkit-line-clamp: 8;
            line-clamp: 8;
        }

        /* Settings Bar */
        .settings-bar {
            background: rgba(10, 10, 15, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            padding: 8px 0;
        }

        .settings-dropdown {
            position: relative;
            display: inline-block;
        }

        .settings-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #9ca3af;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-color: rgba(59, 130, 246, 0.5);
        }

        .settings-btn i { width: 14px; height: 14px; }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 4px;
            background: rgba(15, 15, 20, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            min-width: 180px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-menu.dropdown-up {
            top: auto;
            bottom: 100%;
            margin-top: 0;
            margin-bottom: 4px;
            transform: translateY(10px);
        }

        .dropdown-menu.dropdown-up.active {
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            color: #9ca3af;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dropdown-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: white;
        }

        .dropdown-item.selected {
            color: #60a5fa;
            background: rgba(59, 130, 246, 0.1);
        }

        .dropdown-item img {
            width: 20px;
            height: 14px;
            object-fit: cover;
            border-radius: 2px;
        }

        @media (max-width: 768px) {
            .news-card-title { font-size: 14px; }
            .media-grid.grid-1 .media-item { height: 220px; }
            .media-grid.grid-2 .media-item { height: 150px; }
            .media-grid.grid-3 .media-item { height: 100px; }
            .media-grid.grid-3 .media-item:first-child { height: 202px; }
            .media-grid.grid-4 .media-item { height: 100px; }
            .settings-btn { padding: 5px 10px; font-size: 11px; }
        }

        /* Password Strength Indicator */
        .password-strength {
            margin-top: 10px;
        }

        .strength-bars {
            display: flex;
            gap: 4px;
            margin-bottom: 6px;
        }

        .strength-bar {
            height: 4px;
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .strength-bar .fill {
            height: 100%;
            width: 0;
            border-radius: 2px;
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .strength-bar.active .fill { width: 100%; }

        .strength-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: color 0.3s ease;
        }

        .strength-weak .fill { background: #ef4444; }
        .strength-weak .strength-label { color: #ef4444; }

        .strength-normal .fill { background: #f59e0b; }
        .strength-normal .strength-label { color: #f59e0b; }

        .strength-strong .fill { background: #22c55e; }
        .strength-strong .strength-label { color: #22c55e; }

        .strength-verystrong .fill { background: #3b82f6; }
        .strength-verystrong .strength-label { color: #3b82f6; }

        .strength-incredible .fill { background: linear-gradient(90deg, #8b5cf6, #ec4899); }
        .strength-incredible .strength-label { 
            background: linear-gradient(90deg, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* News Card Time Display */
        .news-card-meta {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .news-card-date {
            font-size: 12px;
            font-weight: 700;
            color: #9ca3af;
        }

        .news-card-exact-time {
            font-size: 13px;
            font-weight: 800;
            color: #09B1F8;
        }

        .news-card-time-separator {
            color: #4b5563;
            font-size: 10px;
        }

        .news-card-relative-time {
            font-size: 11px;
            font-weight: 700;
            color: #6b7280;
            background: rgba(255, 255, 255, 0.05);
            padding: 3px 8px;
            border-radius: 6px;
        }

        /* Mobile Responsiveness */
        @media (max-width: 1024px) {
            .logo-text { font-size: 20px; }
            .logo-circle { width: 40px; height: 40px; }
        }

        @media (max-width: 768px) {
            .news-section h1 { font-size: 2rem; }
            .news-section p { font-size: 0.9rem; }
            .news-grid { grid-template-columns: 1fr; gap: 16px; }
            .news-card { border-radius: 16px; }
            .news-card-content { padding: 16px; }
            .news-card-title { font-size: 14px; }
            .comment-btn { padding: 10px 16px; font-size: 12px; }
            .footer-selectors { flex-direction: column; gap: 12px; }
            .coin-ticker { gap: 12px; }
            .coin-card { padding: 10px 14px; min-width: 140px; }
            .coin-symbol { font-size: 14px; }
            .coin-price { font-size: 14px; }
            .signup-content { padding: 24px; width: 95%; }
            .signup-content h2 { font-size: 24px; }
        }

        @media (max-width: 480px) {
            header .max-w-7xl { padding: 0 12px; }
            .logo-text { font-size: 16px; }
            .logo-circle { width: 32px; height: 32px; }
            .news-section { padding: 20px 12px; }
            .news-section h1 { font-size: 1.5rem; }
            .news-card-content { padding: 14px; }
            .news-card-title { font-size: 13px; }
            .comment-btn { padding: 8px 12px; font-size: 11px; gap: 6px; }
            .comment-icon { width: 14px; height: 14px; }
            .coin-ticker { padding: 8px 0; }
            .coin-card { padding: 8px 10px; min-width: 120px; }
            .coin-icon { width: 24px; height: 24px; }
            .coin-symbol { font-size: 12px; }
            .coin-price { font-size: 12px; }
            .signup-content { padding: 20px; border-radius: 20px; }
            .signup-content h2 { font-size: 22px; }
            .form-group input { padding: 10px 14px; font-size: 14px; }
            .signup-btn { padding: 12px; font-size: 14px; }
        }

        /* News Card Actions */
        .news-card-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
        }

        .comment-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: linear-gradient(135deg, rgba(9, 177, 248, 0.08), rgba(9, 177, 248, 0.02));
            border: 1px solid rgba(9, 177, 248, 0.15);
            border-radius: 14px;
            color: #09B1F8;
            font-size: 13px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.22, 1, 0.36, 1);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .comment-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(9, 177, 248, 0.15), transparent);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .comment-btn:hover::before { opacity: 1; }

        .comment-btn:hover {
            border-color: rgba(9, 177, 248, 0.4);
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(9, 177, 248, 0.15);
        }

        .comment-btn:active { transform: translateY(-1px); }

        .comment-icon {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            transition: transform 0.3s ease;
        }

        .comment-btn:hover .comment-icon {
            transform: scale(1.1);
        }

        .comment-btn span {
            position: relative;
            z-index: 1;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
            <!-- Logo -->
            <div class="logo-container cursor-pointer hover:opacity-90 transition-opacity" onclick="window.location.reload()">
                <div class="logo-circle">
                    <img src="wabble.jpg" alt="WabbleNews Logo">
                        </div>
                <span class="logo-text">Wabble<span class="blue">News</span></span>
                    </div>

            <!-- Navigation -->
            <nav class="hidden lg:flex items-center gap-6">
                <a href="index.html" class="text-sm font-bold text-white" data-translate="home">Home</a>
                <a href="contact.html" class="text-sm font-bold text-white" data-translate="contact">Contact</a>
                <a href="social-media.html" class="text-sm font-bold text-white" data-translate="social">Social Media</a>
                <a href="calendar.html" class="text-sm font-bold text-white" data-translate="calendar">Calendar</a>
                <!-- Sign Up/Sign In Button (hidden when logged in) -->
                <a href="#" id="signUpBtn" onclick="openAuthModal('signup'); return false;" class="text-sm font-bold bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition-colors cursor-pointer" data-translate="signup">Sign Up/Sign In</a>
                <!-- Profile Button (hidden when logged out) -->
                <div id="profileBtn" class="hidden cursor-pointer" onclick="openProfileModal()">
                    <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center border-2 border-blue-400 overflow-hidden" id="headerProfilePicture">
                        <img id="headerProfileImg" src="" alt="Profile" style="display: none; width: 100%; height: 100%; object-fit: cover;">
                        <i data-lucide="user" id="headerProfileIcon" class="w-5 h-5 text-white"></i>
        </div>
                </div>
            </nav>

            <!-- Mobile Menu Button -->
            <button onclick="toggleMenu()" class="lg:hidden p-2 rounded-lg hover:bg-white/10 text-white">
                <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
    </header>


    <!-- Ticker -->
    <div class="ticker-wrapper">
        <div id="ticker-container" class="ticker-container">
            <!-- Coins will be injected here -->
            <div class="flex items-center gap-2 pl-10 text-blue-400 text-sm font-bold">
                <i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>
                <span>Loading market data...</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-6 py-8 w-full">
        <!-- Latest Crypto News Section -->
        <div class="news-section mb-10">
            <h1 class="text-white" data-translate="latest">Latest Crypto News</h1>
            <p data-translate="fastest">The fastest crypto and market news shared almost instantly.</p>
        </div>

        <!-- Telegram News Feed -->
        <div id="telegram-feed" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="col-span-full flex items-center justify-center py-12">
                <div class="flex items-center gap-3 text-blue-400">
                    <i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i>
                    <span class="font-bold">Loading...</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Auth Modal (Sign Up/Sign In) -->
    <div id="authModal" class="signup-modal">
        <div class="signup-content relative signup-mode" id="authContent">
            <button class="close-btn" onclick="closeAuthModal()">
                <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            <h2 id="authTitle">Join WabbleNews</h2>
            <p id="authSubtitle">Create your account to stay updated with the latest crypto news</p>
            
            <!-- Google Sign-In Button -->
            <button type="button" class="google-btn" onclick="handleGoogleSignIn()" id="googleSignInBtn">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                </svg>
                <span>Continue with Google</span>
            </button>

            <div class="divider">
                <span>or</span>
            </div>

            <!-- Sign Up Form -->
            <form id="signupForm" onsubmit="handleSignUp(event)">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        required 
                        autocomplete="username"
                        placeholder="Choose a username"
                        pattern="^[a-zA-Z0-9.]+$"
                        minlength="3"
                        maxlength="20"
                    >
                    <div class="error-message" id="usernameError"></div>
            </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        autocomplete="new-password"
                        placeholder="Create a secure password"
                        minlength="8"
                        oninput="checkPasswordStrength(this.value)"
                    >
                    <div class="password-strength" id="passwordStrength">
                        <div class="strength-bars">
                            <div class="strength-bar" id="bar1"><div class="fill"></div></div>
                            <div class="strength-bar" id="bar2"><div class="fill"></div></div>
                            <div class="strength-bar" id="bar3"><div class="fill"></div></div>
                            <div class="strength-bar" id="bar4"><div class="fill"></div></div>
                            <div class="strength-bar" id="bar5"><div class="fill"></div></div>
                        </div>
                        <span class="strength-label" id="strengthLabel"></span>
                    </div>
                    <div class="error-message" id="passwordError"></div>
        </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        required 
                        autocomplete="new-password"
                        placeholder="Confirm your password"
                        minlength="8"
                    >
                    <div class="error-message" id="confirmPasswordError"></div>
    </div>

                <button type="submit" class="signup-btn" id="signupSubmitBtn">Join Now</button>
                <div class="success-message" id="successMessage">Account created successfully! Welcome to WabbleNews!</div>
            </form>

            <!-- Sign In Form -->
            <form id="signinForm" onsubmit="handleSignIn(event)">
                <div class="form-group">
                    <label for="signinUsername">Username</label>
                    <input 
                        type="text" 
                        id="signinUsername" 
                        name="signinUsername" 
                        required 
                        autocomplete="username"
                        placeholder="Enter your username"
                    >
                    <div class="error-message" id="signinUsernameError"></div>
                </div>
                
                <div class="form-group">
                    <label for="signinPassword">Password</label>
                    <input 
                        type="password" 
                        id="signinPassword" 
                        name="signinPassword" 
                        required 
                        autocomplete="current-password"
                        placeholder="Enter your password"
                    >
                    <div class="error-message" id="signinPasswordError"></div>
                </div>
                
                <button type="submit" class="signup-btn" id="signinSubmitBtn">Sign In</button>
            </form>

            <!-- Toggle Links -->
            <div id="toggleToSignIn" class="toggle-link">
                Have an account? <span class="sign-in-link" onclick="switchToSignIn()">Sign in</span>
                    </div>
            <div id="toggleToSignUp" class="toggle-link" style="display: none;">
                Don't have an account? <span class="sign-up-link" onclick="switchToSignUp()">Sign up</span>
                </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="profile-modal">
        <div class="profile-content relative">
            <button class="close-btn" onclick="closeProfileModal()">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            <h2>Profile Settings</h2>
            <p style="margin-bottom: 24px; color: #9ca3af;">Customize your profile</p>
            
            <form id="profileForm" onsubmit="handleProfileUpdate(event)">
                <div class="profile-picture-container">
                    <div class="profile-picture-wrapper">
                        <div class="profile-picture-preview" onclick="document.getElementById('profilePictureInput').click()">
                            <img id="profilePicturePreview" src="" alt="Profile" style="display: none;">
                            <i data-lucide="user" id="profilePictureIcon"></i>
                        </div>
                        <div class="profile-picture-edit-btn" onclick="document.getElementById('profilePictureInput').click()">
                            <i data-lucide="pencil" class="w-4 h-4"></i>
                        </div>
                    </div>
                    <label for="profilePictureInput" class="file-input-label">Change Photo</label>
                    <input type="file" id="profilePictureInput" accept="image/png,image/jpeg,image/jpg,image/webp,image/gif" onchange="handleProfilePictureChange(event)">
                    <div class="error-message" id="profilePictureError"></div>
                </div>

                <div class="form-group">
                    <label for="profileUsername">Username</label>
                    <input 
                        type="text" 
                        id="profileUsername" 
                        name="profileUsername" 
                        placeholder="Enter your username"
                        maxlength="20"
                        pattern="^[a-zA-Z0-9.]+$"
                    >
                    <div class="error-message" id="usernameChangeError"></div>
                    <div style="margin-top: 4px;">
                        <span id="usernameChangeInfo" style="color: #9ca3af; font-size: 11px; font-weight: 700;"></span>
                    </div>
                    </div>

                <div class="form-group">
                    <label for="profileBio">Bio</label>
                    <div style="position: relative;">
                        <textarea 
                            id="profileBio" 
                            name="profileBio" 
                            placeholder="Tell us about yourself"
                            maxlength="500"
                            class="bio-textarea"
                        ></textarea>
                        <div style="text-align: right; margin-top: 6px;">
                            <span id="bioCharCount" style="color: #9ca3af; font-size: 12px; font-weight: 700;">0/500</span>
                        </div>
            </div>
        </div>

                <button type="submit" class="signup-btn">Save Changes</button>
                <button type="button" class="logout-btn" onclick="handleLogout()">Log Out</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-white/10 py-8 mt-auto">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                <div class="flex items-center gap-3">
                    <!-- Timezone Selector -->
                    <div class="settings-dropdown" id="timezoneDropdown">
                        <button class="settings-btn" onclick="toggleDropdown('timezoneDropdown')">
                            <i data-lucide="clock"></i>
                            <span id="selectedTimezone">Auto</span>
                            <i data-lucide="chevron-down" class="w-3 h-3"></i>
                        </button>
                        <div class="dropdown-menu dropdown-up" id="timezoneMenu">
                            <div class="dropdown-item" data-tz="auto" onclick="setTimezone('auto', 'Auto')">Auto-detect</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+12" onclick="setTimezone('Etc/GMT+12', 'UTC-12')">UTC-12</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+11" onclick="setTimezone('Etc/GMT+11', 'UTC-11')">UTC-11</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+10" onclick="setTimezone('Etc/GMT+10', 'UTC-10')">UTC-10</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+9" onclick="setTimezone('Etc/GMT+9', 'UTC-9')">UTC-9</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+8" onclick="setTimezone('Etc/GMT+8', 'UTC-8')">UTC-8</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+7" onclick="setTimezone('Etc/GMT+7', 'UTC-7')">UTC-7</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+6" onclick="setTimezone('Etc/GMT+6', 'UTC-6')">UTC-6</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+5" onclick="setTimezone('Etc/GMT+5', 'UTC-5')">UTC-5</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+4" onclick="setTimezone('Etc/GMT+4', 'UTC-4')">UTC-4</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+3" onclick="setTimezone('Etc/GMT+3', 'UTC-3')">UTC-3</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+2" onclick="setTimezone('Etc/GMT+2', 'UTC-2')">UTC-2</div>
                            <div class="dropdown-item" data-tz="Etc/GMT+1" onclick="setTimezone('Etc/GMT+1', 'UTC-1')">UTC-1</div>
                            <div class="dropdown-item" data-tz="Etc/GMT" onclick="setTimezone('Etc/GMT', 'UTC+0')">UTC+0</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-1" onclick="setTimezone('Etc/GMT-1', 'UTC+1')">UTC+1</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-2" onclick="setTimezone('Etc/GMT-2', 'UTC+2')">UTC+2</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-3" onclick="setTimezone('Etc/GMT-3', 'UTC+3')">UTC+3</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-4" onclick="setTimezone('Etc/GMT-4', 'UTC+4')">UTC+4</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-5" onclick="setTimezone('Etc/GMT-5', 'UTC+5')">UTC+5</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-6" onclick="setTimezone('Etc/GMT-6', 'UTC+6')">UTC+6</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-7" onclick="setTimezone('Etc/GMT-7', 'UTC+7')">UTC+7</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-8" onclick="setTimezone('Etc/GMT-8', 'UTC+8')">UTC+8</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-9" onclick="setTimezone('Etc/GMT-9', 'UTC+9')">UTC+9</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-10" onclick="setTimezone('Etc/GMT-10', 'UTC+10')">UTC+10</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-11" onclick="setTimezone('Etc/GMT-11', 'UTC+11')">UTC+11</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-12" onclick="setTimezone('Etc/GMT-12', 'UTC+12')">UTC+12</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-13" onclick="setTimezone('Etc/GMT-13', 'UTC+13')">UTC+13</div>
                            <div class="dropdown-item" data-tz="Etc/GMT-14" onclick="setTimezone('Etc/GMT-14', 'UTC+14')">UTC+14</div>
                        </div>
                    </div>
                    <!-- Language Selector -->
                    <div class="settings-dropdown" id="languageDropdown">
                        <button class="settings-btn" onclick="toggleDropdown('languageDropdown')">
                            <i data-lucide="globe"></i>
                            <span id="selectedLanguage">English</span>
                            <i data-lucide="chevron-down" class="w-3 h-3"></i>
                        </button>
                        <div class="dropdown-menu dropdown-up" id="languageMenu">
                            <div class="dropdown-item selected" data-lang="en" onclick="setLanguage('en')">English</div>
                            <div class="dropdown-item" data-lang="tr" onclick="setLanguage('tr')">Trke</div>
                            <div class="dropdown-item" data-lang="zh" onclick="setLanguage('zh')"></div>
                            <div class="dropdown-item" data-lang="ja" onclick="setLanguage('ja')"></div>
                            <div class="dropdown-item" data-lang="ko" onclick="setLanguage('ko')"></div>
                            <div class="dropdown-item" data-lang="ar" onclick="setLanguage('ar')"></div>
                            <div class="dropdown-item" data-lang="es" onclick="setLanguage('es')">Espaol</div>
                            <div class="dropdown-item" data-lang="fr" onclick="setLanguage('fr')">Franais</div>
                            <div class="dropdown-item" data-lang="ru" onclick="setLanguage('ru')"></div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-wrap justify-center gap-4">
                    <a href="terms-of-use.html" class="text-gray-400 hover:text-white text-xs font-bold transition-colors">Terms of Use</a>
                    <span class="text-gray-600"></span>
                    <a href="terms-of-service.html" class="text-gray-400 hover:text-white text-xs font-bold transition-colors">Terms of Service</a>
                </div>
            </div>
            <p class="text-gray-500 text-xs font-bold text-center">Copyright 2025 Wabble News / Crypto Wabble. All rights reserved.</p>
        </div>
    </footer>

    <script>
        lucide.createIcons();

        // Current time display
        function updateCurrentTime() {
            const now = new Date();
            const tz = localStorage.getItem('wabblenews_timezone') || 'auto';
            const options = { month: '2-digit', day: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false };
            if (tz !== 'auto') {
                try { options.timeZone = tz; } catch(e) {}
            }
            const display = document.getElementById('currentTimeDisplay');
            if (display) display.textContent = now.toLocaleString('en-US', options).replace(',', '');
        }
        
        // Add time display element
        if (!document.getElementById('currentTimeDisplay')) {
            const timeEl = document.createElement('div');
            timeEl.id = 'currentTimeDisplay';
            timeEl.style.cssText = 'position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 8px 12px; font-size: 11px; font-weight: 700; color: #9ca3af; z-index: 100;';
            document.body.appendChild(timeEl);
        }
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);

        const API_KEY = 'CG-WGhyowZJTbpZiASkPAsWe2FU';
        const API_URL = 'https://api.coingecko.com/api/v3/coins/markets';
        
        const VALID_COINS = [
            'bitcoin', 'ethereum', 'ripple', 'solana', 'binancecoin', 'dogecoin', 
            'cardano', 'tron', 'avalanche-2', 'shiba-inu', 'toncoin', 'polkadot', 
            'chainlink', 'bitcoin-cash', 'near', 'litecoin', 'pepe', 'uniswap', 
            'aptos', 'hedera-hashgraph', 'stellar', 'internet-computer', 'monero',
            'ethereum-classic', 'render-token', 'cosmos', 'arbitrum', 'optimism', 'sui'
        ];

        let previousPrices = {};

        function formatPrice(num) {
            if (!num) return '-';
            const options = { style: 'currency', currency: 'USD' };
            if (num >= 10.0) {
                options.minimumFractionDigits = 2;
                options.maximumFractionDigits = 2;
            } else if (num >= 0.01) {
                options.minimumFractionDigits = 4;
                options.maximumFractionDigits = 4;
            } else {
                options.minimumFractionDigits = 8;
                options.maximumFractionDigits = 8;
            }
            return new Intl.NumberFormat('en-US', options).format(num);
        }

        let isFetching = false;
        let fetchTimeout = null;
        let retryCount = 0;
        const MAX_RETRIES = 3;
        const RETRY_DELAY = 5000; // 5 seconds

        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        async function fetchData() {
            // Prevent concurrent fetches
            if (isFetching) return;
            
            isFetching = true;
            
            try {
                // Show loading state only if container is empty or has error
                const container = document.getElementById('ticker-container');
                if (container && (container.children.length === 0 || container.querySelector('.text-yellow-500'))) {
                    container.innerHTML = `
                        <div class="flex items-center gap-2 pl-10 text-blue-400 text-sm font-bold">
                            <i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>
                            <span>Loading market data...</span>
                        </div>
                    `;
                    lucide.createIcons();
                }
                
                // Create abort controller for timeout
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000);
                
                let res;
                let lastError;
                
                // Try multiple authentication methods
                const methods = [
                    // Method 1: No auth (free tier)
                    {
                        url: `${API_URL}?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false&price_change_percentage=24h`,
                        headers: { 'Accept': 'application/json' }
                    },
                    // Method 2: API key as query parameter
                    {
                        url: `${API_URL}?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false&price_change_percentage=24h&x_cg_demo_api_key=${API_KEY}`,
                        headers: { 'Accept': 'application/json' }
                    },
                    // Method 3: API key as header
                    {
                        url: `${API_URL}?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false&price_change_percentage=24h`,
                        headers: { 
                            'Accept': 'application/json',
                            'x-cg-demo-api-key': API_KEY
                        }
                    }
                ];
                
                for (const method of methods) {
                    try {
                        res = await fetch(method.url, {
                            method: 'GET',
                            headers: method.headers,
                            signal: controller.signal
                        });
                        
                        if (res.ok) {
                            clearTimeout(timeoutId);
                            break; // Success, exit loop
                        } else if (res.status === 429) {
                            // Rate limited, try next method
                            lastError = new Error('Rate limited');
                            continue;
                        } else {
                            // Other error, try next method
                            const errorText = await res.text();
                            lastError = new Error(`API Error: ${res.status}`);
                            continue;
                        }
                    } catch (fetchError) {
                        if (fetchError.name === 'AbortError') {
                            throw new Error('Request timeout after 15 seconds');
                        }
                        lastError = fetchError;
                        continue; // Try next method
                    }
                }
                
                clearTimeout(timeoutId);
                
                if (!res || !res.ok) {
                    throw lastError || new Error('All API methods failed');
                }
                
                if (!res.ok) {
                    const errorText = await res.text();
                    console.error('API Response Error:', res.status, errorText);
                    throw new Error(`API Error: ${res.status} - ${errorText.substring(0, 100)}`);
                }
                
                const data = await res.json();

                if (!Array.isArray(data)) {
                    throw new Error('Invalid API response format');
                }
                
                const cleanData = data.filter(c => VALID_COINS.includes(c.id));

                if (cleanData.length > 0) {
                renderTicker(cleanData);
                    retryCount = 0; // Reset retry count on success
                } else {
                    throw new Error('No valid coins found in response');
                }
            } catch (e) {
                console.error("Error fetching data:", e);
                retryCount++;
                
                // Show error state with more details
                const container = document.getElementById('ticker-container');
                if (container) {
                    const errorMessage = e.message || 'Unknown error';
                    const errorHtml = `
                        <div class="flex flex-col items-start gap-2 pl-10 text-yellow-500 text-sm font-bold">
                            <div class="flex items-center gap-2">
                                <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                <span>API Error${retryCount < MAX_RETRIES ? `. Retrying... (${retryCount}/${MAX_RETRIES})` : ''}</span>
                            </div>
                            <span class="text-xs text-yellow-400 font-normal">${errorMessage.substring(0, 80)}</span>
                        </div>
                    `;
                    if (container.innerHTML !== errorHtml) {
                        container.innerHTML = errorHtml;
                        lucide.createIcons();
                    }
                }
                
                // Retry logic
                if (retryCount < MAX_RETRIES) {
                    fetchTimeout = setTimeout(() => {
                        isFetching = false;
                        fetchData();
                    }, RETRY_DELAY);
                    return; // Don't set isFetching to false yet
                } else {
                    // Show final error message
                    if (container) {
                        container.innerHTML = `
                            <div class="flex flex-col items-start gap-2 pl-10 text-red-500 text-sm font-bold">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                                    <span>Failed to load data. Please refresh the page.</span>
                                </div>
                                <button onclick="location.reload()" class="text-xs text-blue-400 hover:text-blue-300 underline mt-2">Click to refresh</button>
                            </div>
                        `;
                        lucide.createIcons();
                    }
                }
            } finally {
                if (!fetchTimeout) {
                    isFetching = false;
                }
            }
        }


        function renderTicker(coins) {
            const container = document.getElementById('ticker-container');
            if (!container) return;
            
            // Use DocumentFragment for better performance
            const fragment = document.createDocumentFragment();
            
            // Duplicate coins for seamless infinite scroll
            const duplicatedCoins = [...coins, ...coins];
            
            duplicatedCoins.forEach((coin, index) => {
                // Check if price is up or down based on 24h change
                const isUp = coin.price_change_percentage_24h >= 0;
                const priceClass = isUp ? 'price-up' : 'price-down';
                const changeClass = isUp ? 'up' : 'down';
                const arrow = isUp ? '' : '';
                
                // Check if price changed compared to previous fetch
                const previousPrice = previousPrices[coin.id];
                let highlightClass = '';
                let borderHighlightClass = '';
                
                // Only check for first occurrence of each coin (not duplicates)
                if (index < coins.length && previousPrice !== undefined) {
                    // Compare with small tolerance for floating point precision
                    const priceDiff = Math.abs(coin.current_price - previousPrice);
                    const tolerance = 0.00000001;
                    
                    if (priceDiff > tolerance) {
                        // Price changed - determine if up or down
                        if (coin.current_price > previousPrice) {
                            highlightClass = 'highlight-up';
                            borderHighlightClass = 'highlight-border-up';
                        } else {
                            highlightClass = 'highlight-down';
                            borderHighlightClass = 'highlight-border-down';
                        }
                    }
                }
                
                // Create coin pill element
                const coinPill = document.createElement('div');
                coinPill.className = `coin-pill ${priceClass}`;
                coinPill.setAttribute('data-coin-id', coin.id);
                
                // Add border highlight class if price changed
                if (borderHighlightClass) {
                    coinPill.classList.add(borderHighlightClass);
                }
                
                coinPill.innerHTML = `
                    <div class="coin-icon">
                        <img src="${coin.image}" alt="${coin.symbol}" loading="lazy" onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\\'width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;font-size:12px;\\'>${coin.symbol.substring(0,2)}</div>'">
                        </div>
                    <div class="coin-info">
                        <div class="coin-symbol-price">
                            <span class="coin-symbol">${coin.symbol}</span>
                            <span class="coin-price ${highlightClass}">${formatPrice(coin.current_price)}</span>
                            </div>
                        <span class="coin-change ${changeClass}">
                            ${arrow} ${Math.abs(coin.price_change_percentage_24h || 0).toFixed(2)}%
                            </span>
                    </div>
                `;
                
                fragment.appendChild(coinPill);
                
                // Update previous price AFTER rendering (only for unique coins)
                if (index < coins.length) {
                    previousPrices[coin.id] = coin.current_price;
                }
            });
            
            // Clear and update container smoothly
            container.innerHTML = '';
            container.appendChild(fragment);
            
            // Reinitialize icons after DOM update
            lucide.createIcons();
        }

        // Initialize with debounced fetch
        const debouncedFetchData = debounce(fetchData, 500);
        
        // Initial fetch
        fetchData();
        
        // Set up interval for auto-refresh (every 15 seconds)
        setInterval(() => {
            if (!isFetching) {
                fetchData();
            }
        }, 15000);

        // Test function to simulate price changes
        function testPriceChange() {
            const container = document.getElementById('ticker-container');
            if (!container) return;
            
            const coinPills = container.querySelectorAll('.coin-pill');
            if (coinPills.length === 0) {
                alert('Please wait for coins to load first!');
                return;
            }
            
            // Get first few coins and simulate price changes
            coinPills.forEach((pill, index) => {
                if (index >= 10) return; // Only test first 10 coins
                
                const priceElement = pill.querySelector('.coin-price');
                if (!priceElement) return;
                
                // Get current price
                const currentPriceText = priceElement.textContent;
                const currentPrice = parseFloat(currentPriceText.replace(/[^0-9.]/g, ''));
                
                if (isNaN(currentPrice)) return;
                
                // Randomly decide if price goes up or down
                const goesUp = Math.random() > 0.5;
                const changePercent = (Math.random() * 5 + 1) / 100; // 1-6% change
                
                let newPrice;
                if (goesUp) {
                    newPrice = currentPrice * (1 + changePercent);
                } else {
                    newPrice = currentPrice * (1 - changePercent);
                }
                
                // Temporarily store old price for comparison
                const coinId = pill.getAttribute('data-coin-id') || `test-${index}`;
                previousPrices[coinId] = currentPrice;
                
                // Remove old highlight classes
                priceElement.classList.remove('highlight-up', 'highlight-down');
                pill.classList.remove('highlight-border-up', 'highlight-border-down');
                
                // Update price
                priceElement.textContent = formatPrice(newPrice);
                
                // Force reflow for smooth animation
                void priceElement.offsetWidth;
                
                // Add appropriate highlight classes
                if (goesUp) {
                    priceElement.classList.add('highlight-up');
                    pill.classList.add('highlight-border-up');
                } else {
                    priceElement.classList.add('highlight-down');
                    pill.classList.add('highlight-border-down');
                }
                
                // Update previous price
                previousPrices[coinId] = newPrice;
            });
        }
        
        // Add visibility change listener to pause/resume when tab is hidden/visible
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Tab is hidden - could pause updates here if needed
            } else {
                // Tab is visible - refresh data
                if (!isFetching) {
                    fetchData();
                }
            }
        });

        // Mobile menu toggle
        function toggleMenu() {
            console.log('Menu toggle');
        }

        // Check if user is logged in on page load
        function checkLoginStatus() {
            const currentUser = localStorage.getItem('wabblenews_current_user');
            if (currentUser) {
                document.getElementById('signUpBtn').classList.add('hidden');
                document.getElementById('profileBtn').classList.remove('hidden');
                loadProfileData();
            } else {
                document.getElementById('signUpBtn').classList.remove('hidden');
                document.getElementById('profileBtn').classList.add('hidden');
            }
        }

        // Auth Modal Functions
        function openAuthModal(mode = 'signup') {
            const modal = document.getElementById('authModal');
            if (!modal) {
                console.error('Auth modal not found');
                return;
            }
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            if (mode === 'signin') {
                switchToSignIn();
            } else {
                switchToSignUp();
            }
            lucide.createIcons();
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.body.style.overflow = '';
            // Reset forms
            document.getElementById('signupForm').reset();
            document.getElementById('signinForm').reset();
            document.getElementById('successMessage').classList.remove('show');
            clearAllErrors();
            // Reset button states
            const signupBtn = document.getElementById('signupSubmitBtn');
            const signinBtn = document.getElementById('signinSubmitBtn');
            if (signupBtn) {
                signupBtn.disabled = false;
                signupBtn.textContent = 'Join Now';
                signupBtn.style.background = '';
            }
            if (signinBtn) {
                signinBtn.disabled = false;
                signinBtn.textContent = 'Sign In';
                signinBtn.style.background = '';
            }
        }

        // Google OAuth Configuration
        const GOOGLE_CLIENT_ID = '798158583330-a66fqrfdo8h2vqftianm89j04mt84upc.apps.googleusercontent.com';
        
        // Handle Google Sign-In
        function handleGoogleSignIn() {
            const googleBtn = document.getElementById('googleSignInBtn');
            if (googleBtn) {
                googleBtn.disabled = true;
                googleBtn.querySelector('span').textContent = 'Connecting...';
            }
            
            // Generate a random state for security
            const state = Math.random().toString(36).substring(2, 15);
            sessionStorage.setItem('google_oauth_state', state);
            
            // Get the current page URL for redirect
            const redirectUri = window.location.origin + window.location.pathname;
            
            // Build OAuth URL
            const authUrl = new URL('https://accounts.google.com/o/oauth2/v2/auth');
            authUrl.searchParams.set('client_id', GOOGLE_CLIENT_ID);
            authUrl.searchParams.set('redirect_uri', redirectUri);
            authUrl.searchParams.set('response_type', 'token');
            authUrl.searchParams.set('scope', 'openid email profile');
            authUrl.searchParams.set('state', state);
            authUrl.searchParams.set('prompt', 'select_account');
            
            // Redirect to Google OAuth
            window.location.href = authUrl.toString();
        }
        
        // Handle OAuth callback (check URL for token on page load)
        function handleOAuthCallback() {
            const hash = window.location.hash;
            if (!hash || !hash.includes('access_token')) return;
            
            // Parse the hash fragment
            const params = new URLSearchParams(hash.substring(1));
            const accessToken = params.get('access_token');
            const state = params.get('state');
            
            // Verify state
            const savedState = sessionStorage.getItem('google_oauth_state');
            if (state !== savedState) {
                console.error('OAuth state mismatch');
                return;
            }
            sessionStorage.removeItem('google_oauth_state');
            
            // Clear the hash from URL
            history.replaceState(null, '', window.location.pathname);
            
            if (accessToken) {
                // Fetch user info from Google
                fetchGoogleUserInfo(accessToken);
            }
        }
        
        // Fetch user info from Google API
        async function fetchGoogleUserInfo(accessToken) {
            try {
                const response = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch user info');
                }
                
                const userInfo = await response.json();
                
                // Create or sign in user with Google account
                handleGoogleUser(userInfo);
                
            } catch (error) {
                console.error('Error fetching Google user info:', error);
                alert('Failed to sign in with Google. Please try again.');
            }
        }
        
        // Handle Google user sign in/sign up
        function handleGoogleUser(userInfo) {
            const googleId = userInfo.id;
            const email = userInfo.email;
            const name = userInfo.name || email.split('@')[0];
            const picture = userInfo.picture || '';
            
            // Create a username from email (remove special chars)
            let username = email.split('@')[0].replace(/[^a-zA-Z0-9.]/g, '').toLowerCase();
            if (username.length < 3) username = 'user' + googleId.substring(0, 6);
            if (username.length > 20) username = username.substring(0, 20);
            
            const accounts = JSON.parse(localStorage.getItem('wabblenews_accounts') || '{}');
            
            // Check if user already exists with this Google ID
            let existingUser = null;
            for (const [key, account] of Object.entries(accounts)) {
                if (account.googleId === googleId) {
                    existingUser = key;
                    break;
                }
            }
            
            if (existingUser) {
                // User exists, sign them in
                createSession(existingUser);
                checkLoginStatus();
                closeAuthModal();
            } else {
                // New user, create account
                // Make username unique if needed
                let finalUsername = username;
                let counter = 1;
                while (accounts.hasOwnProperty(finalUsername.toLowerCase())) {
                    finalUsername = username + counter;
                    counter++;
                }
                
                accounts[finalUsername.toLowerCase()] = {
                    username: finalUsername,
                    googleId: googleId,
                    email: email,
                    createdAt: new Date().toISOString(),
                    profile: {
                        name: name,
                        bio: '',
                        picture: picture
                    }
                };
                localStorage.setItem('wabblenews_accounts', JSON.stringify(accounts));
                
                // Sign in the new user
                createSession(finalUsername);
                checkLoginStatus();
                closeAuthModal();
            }
        }
        
        // Check for OAuth callback on page load
        handleOAuthCallback();

        function switchToSignIn() {
            document.getElementById('authContent').classList.remove('signup-mode');
            document.getElementById('authContent').classList.add('signin-mode');
            document.getElementById('authTitle').textContent = 'Welcome Back';
            document.getElementById('authSubtitle').textContent = 'Sign in to your account';
            document.getElementById('toggleToSignIn').style.display = 'none';
            document.getElementById('toggleToSignUp').style.display = 'block';
            clearAllErrors();
        }

        function switchToSignUp() {
            document.getElementById('authContent').classList.remove('signin-mode');
            document.getElementById('authContent').classList.add('signup-mode');
            document.getElementById('authTitle').textContent = 'Join WabbleNews';
            document.getElementById('authSubtitle').textContent = 'Create your account to stay updated with the latest crypto news';
            document.getElementById('toggleToSignIn').style.display = 'block';
            document.getElementById('toggleToSignUp').style.display = 'none';
            clearAllErrors();
        }

        function clearAllErrors() {
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('input').forEach(el => el.classList.remove('error'));
        }

        // Close modal on outside click
        const authModal = document.getElementById('authModal');
        if (authModal) {
            authModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAuthModal();
                }
            });
        }

        const profileModal = document.getElementById('profileModal');
        if (profileModal) {
            profileModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeProfileModal();
                }
            });
        }

        // Username validation
        function validateUsername(username) {
            // Can't start with underscore
            if (username.startsWith('_')) {
                return { valid: false, error: 'Username cannot start with underscore' };
            }
            
            // Only letters, digits, and dots allowed
            if (!/^[a-zA-Z0-9.]+$/.test(username)) {
                return { valid: false, error: 'Username can only contain letters, numbers, and dots' };
            }
            
            // Can't contain underscore, plus, question mark, etc.
            if (/[_+?@#$%^&*()!]/.test(username)) {
                return { valid: false, error: 'Username cannot contain special characters like _, +, ?, etc.' };
            }
            
            // Length check
            if (username.length < 3) {
                return { valid: false, error: 'Username must be at least 3 characters' };
            }
            
            if (username.length > 20) {
                return { valid: false, error: 'Username must be less than 20 characters' };
            }
            
            return { valid: true };
        }

        // Check if username exists
        function usernameExists(username) {
            const accounts = JSON.parse(localStorage.getItem('wabblenews_accounts') || '{}');
            return accounts.hasOwnProperty(username.toLowerCase());
        }

        // Hash password (simple SHA-256 hash)
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        // Handle sign up form submission
        async function handleSignUp(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const usernameError = document.getElementById('usernameError');
            const passwordError = document.getElementById('passwordError');
            const confirmPasswordError = document.getElementById('confirmPasswordError');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const signupBtn = document.getElementById('signupSubmitBtn');
            const successMessage = document.getElementById('successMessage');
            
            // Reset errors
            clearAllErrors();
            successMessage.classList.remove('show');
            
            // Validate username
            const usernameValidation = validateUsername(username);
            if (!usernameValidation.valid) {
                usernameError.textContent = usernameValidation.error;
                usernameError.classList.add('show');
                usernameInput.classList.add('error');
                return;
            }
            
            // Check if username already exists
            if (usernameExists(username)) {
                usernameError.textContent = 'Username already taken. Please choose another.';
                usernameError.classList.add('show');
                usernameInput.classList.add('error');
                return;
            }
            
            // Validate password
            if (password.length < 8) {
                passwordError.textContent = 'Password must be at least 8 characters';
                passwordError.classList.add('show');
                passwordInput.classList.add('error');
                return;
            }
            
            // Validate confirm password
            if (password !== confirmPassword) {
                confirmPasswordError.textContent = 'Passwords do not match';
                confirmPasswordError.classList.add('show');
                confirmPasswordInput.classList.add('error');
                return;
            }
            
            // Disable button
            signupBtn.disabled = true;
            signupBtn.textContent = 'Creating Account...';
            
            try {
                // Hash password
                const hashedPassword = await hashPassword(password);
                
                // Store account (only store hashed password, never plaintext)
                const accounts = JSON.parse(localStorage.getItem('wabblenews_accounts') || '{}');
                accounts[username.toLowerCase()] = {
                    username: username,
                    passwordHash: hashedPassword,
                    createdAt: new Date().toISOString(),
                    profile: {
                        name: '',
                        bio: '',
                        picture: ''
                    }
                };
                localStorage.setItem('wabblenews_accounts', JSON.stringify(accounts));
                
                // Auto sign in after sign up - create session
                createSession(username);
                checkLoginStatus();
                
                // Show success message
                successMessage.classList.add('show');
                signupBtn.textContent = 'Account Created!';
                
                // Close modal after 2 seconds
                setTimeout(() => {
                    closeAuthModal();
                }, 2000);
                
            } catch (error) {
                console.error('Error creating account:', error);
                passwordError.textContent = 'An error occurred. Please try again.';
                passwordError.classList.add('show');
                signupBtn.disabled = false;
                signupBtn.textContent = 'Join Now';
            }
        }


        // Real-time username validation
        document.getElementById('username').addEventListener('input', function(e) {
            const username = e.target.value.trim();
            const usernameError = document.getElementById('usernameError');
            const usernameInput = e.target;
            
            if (username.length === 0) {
                usernameError.classList.remove('show');
                usernameInput.classList.remove('error');
                return;
            }
            
            const validation = validateUsername(username);
            if (!validation.valid) {
                usernameError.textContent = validation.error;
                usernameError.classList.add('show');
                usernameInput.classList.add('error');
            } else if (usernameExists(username)) {
                usernameError.textContent = 'Username already taken';
                usernameError.classList.add('show');
                usernameInput.classList.add('error');
            } else {
                usernameError.classList.remove('show');
                usernameInput.classList.remove('error');
            }
        });

        // Real-time confirm password validation
        document.getElementById('confirmPassword').addEventListener('input', function(e) {
            const password = document.getElementById('password').value;
            const confirmPassword = e.target.value;
            const confirmPasswordError = document.getElementById('confirmPasswordError');
            const confirmPasswordInput = e.target;
            
            if (confirmPassword.length === 0) {
                confirmPasswordError.classList.remove('show');
                confirmPasswordInput.classList.remove('error');
                return;
            }
            
            if (password !== confirmPassword) {
                confirmPasswordError.textContent = 'Passwords do not match';
                confirmPasswordError.classList.add('show');
                confirmPasswordInput.classList.add('error');
            } else {
                confirmPasswordError.classList.remove('show');
                confirmPasswordInput.classList.remove('error');
            }
        });

        // Profile Modal Functions
        function openProfileModal() {
            document.getElementById('profileModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            loadProfileData();
            lucide.createIcons();
            
            // Initialize bio character counter
            setTimeout(() => {
                updateBioCharCount();
            }, 100);
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function loadProfileData() {
            const currentUser = localStorage.getItem('wabblenews_current_user');
            if (!currentUser) return;
            
            const accounts = JSON.parse(localStorage.getItem('wabblenews_accounts') || '{}');
            const account = accounts[currentUser];
            
            if (account) {
                // Load username (show current username)
                const usernameInput = document.getElementById('profileUsername');
                if (usernameInput) {
                    usernameInput.value = account.username || currentUser;
                }
                
                // Check username change cooldown
                checkUsernameChangeCooldown(account);
                
                // Load profile data
                if (account.profile) {
                    document.getElementById('profileBio').value = account.profile.bio || '';
                    
                    // Update bio character count
                    updateBioCharCount();
                    
                    // Load profile picture
                    if (account.profile.picture) {
                        document.getElementById('profilePicturePreview').src = account.profile.picture;
                        document.getElementById('profilePicturePreview').style.display = 'block';
                        document.getElementById('profilePictureIcon').style.display = 'none';
                    } else {
                        document.getElementById('profilePicturePreview').style.display = 'none';
                        document.getElementById('profilePictureIcon').style.display = 'block';
                    }
                } else {
                    // Initialize empty profile
                    document.getElementById('profileBio').value = '';
                    document.getElementById('profilePicturePreview').style.display = 'none';
                    document.getElementById('profilePictureIcon').style.display = 'block';
                    updateBioCharCount();
                }
                
                // Update header profile picture
                updateHeaderProfilePicture(account.profile?.picture);
            }
        }

        function checkUsernameChangeCooldown(account) {
            const usernameInput = document.getElementById('profileUsername');
            const errorDiv = document.getElementById('usernameChangeError');
            const infoDiv = document.getElementById('usernameChangeInfo');
            
            if (!account.usernameLastChanged) {
                // Never changed before
                if (infoDiv) {
                    infoDiv.textContent = 'You can change your username';
                    infoDiv.style.color = '#22c55e';
                }
                if (usernameInput) {
                    usernameInput.disabled = false;
                }
                return true;
            }
            
            const lastChanged = new Date(account.usernameLastChanged);
            const now = new Date();
            const daysSinceChange = (now - lastChanged) / (1000 * 60 * 60 * 24);
            const daysRemaining = Math.ceil(7 - daysSinceChange);
            
            if (daysSinceChange >= 7) {
                // Cooldown expired
                if (infoDiv) {
                    infoDiv.textContent = 'You can change your username';
                    infoDiv.style.color = '#22c55e';
                }
                if (usernameInput) {
                    usernameInput.disabled = false;
                }
                return true;
            } else {
                // Still in cooldown
                if (infoDiv) {
                    infoDiv.textContent = `Username can be changed in ${daysRemaining} day${daysRemaining !== 1 ? 's' : ''}`;
                    infoDiv.style.color = '#ef4444';
                }
                if (usernameInput) {
                    usernameInput.disabled = true;
                    usernameInput.style.opacity = '0.5';
                    usernameInput.style.cursor = 'not-allowed';
                }
                return false;
            }
        }

        function updateHeaderProfilePicture(pictureUrl) {
            const headerImg = document.getElementById('headerProfileImg');
            const headerIcon = document.getElementById('headerProfileIcon');
            
            if (pictureUrl) {
                headerImg.src = pictureUrl;
                headerImg.style.display = 'block';
                headerIcon.style.display = 'none';
            } else {
                headerImg.style.display = 'none';
                headerIcon.style.display = 'block';
            }
        }

        function updateBioCharCount() {
            const bio = document.getElementById('profileBio');
            const charCount = document.getElementById('bioCharCount');
            if (bio && charCount) {
                const length = bio.value.length;
                charCount.textContent = `${length}/500`;
                if (length > 450) {
                    charCount.style.color = '#ef4444';
                } else {
                    charCount.style.color = '#9ca3af';
                }
            }
        }

        function handleProfilePictureChange(event) {
            const file = event.target.files[0];
            const errorDiv = document.getElementById('profilePictureError');
            
            // Clear previous errors
            if (errorDiv) {
                errorDiv.classList.remove('show');
                errorDiv.textContent = '';
            }
            
            if (!file) {
                return;
            }
            
            // Validate file type - only allow safe image formats
            const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/webp', 'image/gif'];
            const fileExtension = file.name.split('.').pop().toLowerCase();
            const allowedExtensions = ['png', 'jpg', 'jpeg', 'webp', 'gif'];
            
            // Check MIME type and extension
            if (!allowedTypes.includes(file.type) || !allowedExtensions.includes(fileExtension)) {
                if (errorDiv) {
                    errorDiv.textContent = 'Only PNG, JPG, JPEG, WEBP, and GIF images are allowed';
                    errorDiv.classList.add('show');
                }
                event.target.value = '';
                return;
            }
            
            // Check file size (max 5MB)
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) {
                if (errorDiv) {
                    errorDiv.textContent = 'Image size must be less than 5MB';
                    errorDiv.classList.add('show');
                }
                event.target.value = '';
                return;
            }
            
            // First validate file signature, then read as data URL for preview
            const validationReader = new FileReader();
            validationReader.onload = function(validationEvent) {
                const arrayBuffer = validationEvent.target.result;
                const bytes = new Uint8Array(arrayBuffer);
                
                // Check file signatures (magic numbers) for image files
                let isValidImage = false;
                
                // PNG: 89 50 4E 47
                if (bytes[0] === 0x89 && bytes[1] === 0x50 && bytes[2] === 0x4E && bytes[3] === 0x47) {
                    isValidImage = true;
                }
                // JPEG: FF D8 FF
                else if (bytes[0] === 0xFF && bytes[1] === 0xD8 && bytes[2] === 0xFF) {
                    isValidImage = true;
                }
                // GIF: 47 49 46 38
                else if (bytes[0] === 0x47 && bytes[1] === 0x49 && bytes[2] === 0x46 && bytes[3] === 0x38) {
                    isValidImage = true;
                }
                // WEBP: Check for RIFF...WEBP
                else if (bytes[0] === 0x52 && bytes[1] === 0x49 && bytes[2] === 0x46 && bytes[3] === 0x46) {
                    // Check for WEBP further in the file
                    const str = String.fromCharCode.apply(null, bytes.slice(8, 12));
                    if (str === 'WEBP') {
                        isValidImage = true;
                    }
                }
                
                if (!isValidImage) {
                    if (errorDiv) {
                        errorDiv.textContent = 'Invalid image file. Only PNG, JPG, WEBP, and GIF are allowed';
                        errorDiv.classList.add('show');
                    }
                    event.target.value = '';
                    return;
                }
                
                // File is valid - now read as data URL for preview
                const previewReader = new FileReader();
                previewReader.onload = function(previewEvent) {
                    const imageUrl = previewEvent.target.result;
                    document.getElementById('profilePicturePreview').src = imageUrl;
                    document.getElementById('profilePicturePreview').style.display = 'block';
                    document.getElementById('profilePictureIcon').style.display = 'none';
                };
                
                previewReader.onerror = function() {
                    if (errorDiv) {
                        errorDiv.textContent = 'Error reading file. Please try again.';
                        errorDiv.classList.add('show');
                    }
                };
                
                previewReader.readAsDataURL(file);
            };
            
            validationReader.onerror = function() {
                if (errorDiv) {
                    errorDiv.textContent = 'Error validating file. Please try again.';
                    errorDiv.classList.add('show');
                }
            };
            
            validationReader.readAsArrayBuffer(file);
        }

        function handleProfileUpdate(event) {
            event.preventDefault();
            
            let currentUser = localStorage.getItem('wabblenews_current_user');
            if (!currentUser) {
                alert('You must be logged in to update your profile');
                return;
            }
            
            const accounts = JSON.parse(localStorage.getItem('wabblenews_accounts') || '{}');
            let account = accounts[currentUser];
            
            if (!account) {
                alert('Account not found');
                return;
            }
            
            const usernameError = document.getElementById('usernameChangeError');
            const usernameInput = document.getElementById('profileUsername');
            
            // Validate and handle username change
            const newUsername = usernameInput ? usernameInput.value.trim() : '';
            const currentUsername = account.username || currentUser;
            
            if (newUsername && newUsername !== currentUsername) {
                // Check cooldown
                if (!checkUsernameChangeCooldown(account)) {
                    if (usernameError) {
                        usernameError.textContent = 'Username can only be changed once per week';
                        usernameError.classList.add('show');
                    }
                    if (usernameInput) {
                        usernameInput.classList.add('error');
                    }
                    return;
                }
                
                // Validate username
                const usernameValidation = validateUsername(newUsername);
                if (!usernameValidation.valid) {
                    if (usernameError) {
                        usernameError.textContent = usernameValidation.error;
                        usernameError.classList.add('show');
                    }
                    if (usernameInput) {
                        usernameInput.classList.add('error');
                    }
                    return;
                }
                
                // Check if username already exists
                if (usernameExists(newUsername) && newUsername.toLowerCase() !== currentUser.toLowerCase()) {
                    if (usernameError) {
                        usernameError.textContent = 'Username already taken';
                        usernameError.classList.add('show');
                    }
                    if (usernameInput) {
                        usernameInput.classList.add('error');
                    }
                    return;
                }
                
                // Update username and set cooldown
                const oldUsername = currentUser;
                const newUsernameLower = newUsername.toLowerCase();
                
                // Update account with new username
                account.username = newUsername;
                account.usernameLastChanged = new Date().toISOString();
                
                // Move account to new username key if username changed
                if (oldUsername !== newUsernameLower) {
                    accounts[newUsernameLower] = account;
                    delete accounts[oldUsername];
                    localStorage.setItem('wabblenews_current_user', newUsernameLower);
                    currentUser = newUsernameLower;
                }
            }
            
            // Handle profile picture - always check for new picture
            const picturePreview = document.getElementById('profilePicturePreview');
            let pictureUrl = account.profile?.picture || '';
            
            if (picturePreview) {
                const pictureSrc = picturePreview.src;
                if (pictureSrc && pictureSrc.startsWith('data:image')) {
                    pictureUrl = pictureSrc;
                } else if (pictureSrc && pictureSrc.startsWith('blob:')) {
                    pictureUrl = pictureSrc;
                } else if (pictureSrc && pictureSrc.length > 0 && pictureSrc !== '') {
                    // Keep existing picture if it's a valid URL
                    if (picturePreview.style.display !== 'none') {
                        pictureUrl = pictureSrc;
                    }
                }
            }
            
            // Update profile
            if (!account.profile) {
                account.profile = {};
            }
            
            const bioElement = document.getElementById('profileBio');
            account.profile.bio = bioElement ? bioElement.value.trim() : '';
            account.profile.picture = pictureUrl;
            
            // Save account
            accounts[currentUser.toLowerCase()] = account;
            localStorage.setItem('wabblenews_accounts', JSON.stringify(accounts));
            
            // Update header profile picture immediately
            updateHeaderProfilePicture(pictureUrl);
            
            // Clear errors
            if (usernameError) {
                usernameError.classList.remove('show');
            }
            if (usernameInput) {
                usernameInput.classList.remove('error');
            }
            
            // Show success
            const btn = event.target.querySelector('button[type="submit"]');
            if (btn) {
                const originalText = btn.textContent;
                btn.textContent = 'Saved!';
                btn.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                
                // Close modal after 1 second
                setTimeout(() => {
                    closeProfileModal();
                    checkLoginStatus();
                    btn.textContent = originalText;
                    btn.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
                }, 1000);
            } else {
                // Fallback if button not found
                alert('Profile saved successfully!');
                closeProfileModal();
                checkLoginStatus();
            }
        }

        // Add bio character count listener when modal opens
        const profileBio = document.getElementById('profileBio');
        if (profileBio) {
            profileBio.addEventListener('input', updateBioCharCount);
        }

        function handleLogout() {
            // Clear session
            localStorage.removeItem('wabblenews_current_user');
            localStorage.removeItem('wabblenews_session_token');
            
            // Reset UI
            checkLoginStatus();
            closeProfileModal();
            
            // Reset auth modal to sign up mode
            switchToSignUp();
            
            // Clear any form data
            document.getElementById('signupForm').reset();
            document.getElementById('signinForm').reset();
            clearAllErrors();
        }

        // Enhanced Authentication System
        function generateSessionToken() {
            const array = new Uint8Array(32);
            crypto.getRandomValues(array);
            return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
        }

        function createSession(username) {
            const token = generateSessionToken();
            const sessionData = {
                username: username.toLowerCase(),
                token: token,
                createdAt: new Date().toISOString(),
                expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString() // 7 days
            };
            
            localStorage.setItem('wabblenews_session_token', JSON.stringify(sessionData));
            localStorage.setItem('wabblenews_current_user', username.toLowerCase());
            
            return token;
        }

        function validateSession() {
            const sessionData = localStorage.getItem('wabblenews_session_token');
            if (!sessionData) return false;
            
            try {
                const session = JSON.parse(sessionData);
                const expiresAt = new Date(session.expiresAt);
                
                if (expiresAt < new Date()) {
                    // Session expired
                    handleLogout();
                    return false;
                }
                
                return true;
            } catch (e) {
                return false;
            }
        }

        // Improved sign in with better error handling
        async function handleSignIn(event) {
            event.preventDefault();
            
            const username = document.getElementById('signinUsername').value.trim();
            const password = document.getElementById('signinPassword').value;
            const usernameError = document.getElementById('signinUsernameError');
            const passwordError = document.getElementById('signinPasswordError');
            const usernameInput = document.getElementById('signinUsername');
            const passwordInput = document.getElementById('signinPassword');
            const signinBtn = document.getElementById('signinSubmitBtn');
            
            // Reset errors
            clearAllErrors();
            
            // Validate inputs
            if (!username) {
                usernameError.textContent = 'Username is required';
                usernameError.classList.add('show');
                usernameInput.classList.add('error');
                return;
            }
            
            if (!password) {
                passwordError.textContent = 'Password is required';
                passwordError.classList.add('show');
                passwordInput.classList.add('error');
                return;
            }
            
            // Check if username exists
            if (!usernameExists(username)) {
                usernameError.textContent = 'Username not found';
                usernameError.classList.add('show');
                usernameInput.classList.add('error');
                return;
            }
            
            // Disable button
            signinBtn.disabled = true;
            signinBtn.textContent = 'Signing In...';
            
            try {
                // Hash password and compare
                const hashedPassword = await hashPassword(password);
                const accounts = JSON.parse(localStorage.getItem('wabblenews_accounts') || '{}');
                const account = accounts[username.toLowerCase()];
                
                if (!account) {
                    usernameError.textContent = 'Account not found';
                    usernameError.classList.add('show');
                    usernameInput.classList.add('error');
                    signinBtn.disabled = false;
                    signinBtn.textContent = 'Sign In';
                    return;
                }
                
                if (account.passwordHash !== hashedPassword) {
                    passwordError.textContent = 'Incorrect password';
                    passwordError.classList.add('show');
                    passwordInput.classList.add('error');
                    signinBtn.disabled = false;
                    signinBtn.textContent = 'Sign In';
                    return;
                }
                
                // Sign in successful - create session
                createSession(username);
                checkLoginStatus();
                
                // Show success briefly
                signinBtn.textContent = 'Success!';
                signinBtn.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
                
                setTimeout(() => {
                    closeAuthModal();
                    signinBtn.textContent = 'Sign In';
                    signinBtn.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
                }, 1000);
                
            } catch (error) {
                console.error('Error signing in:', error);
                passwordError.textContent = 'An error occurred. Please try again.';
                passwordError.classList.add('show');
                signinBtn.disabled = false;
                signinBtn.textContent = 'Sign In';
            }
        }

        // Enhanced checkLoginStatus with session validation
        function checkLoginStatus() {
            if (!validateSession()) {
                document.getElementById('signUpBtn').classList.remove('hidden');
                document.getElementById('profileBtn').classList.add('hidden');
                return;
            }
            
            const currentUser = localStorage.getItem('wabblenews_current_user');
            if (currentUser) {
                document.getElementById('signUpBtn').classList.add('hidden');
                document.getElementById('profileBtn').classList.remove('hidden');
                loadProfileData();
            } else {
                document.getElementById('signUpBtn').classList.remove('hidden');
                document.getElementById('profileBtn').classList.add('hidden');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            lucide.createIcons();
        });
        
        // Also run immediately in case DOM is already loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                checkLoginStatus();
                lucide.createIcons();
            });
        } else {
            checkLoginStatus();
            lucide.createIcons();
        }
        
        setInterval(() => {
            if (localStorage.getItem('wabblenews_current_user')) {
                if (!validateSession()) {
                    checkLoginStatus();
                }
            }
        }, 60000);

        const TELEGRAM_BOT_TOKEN = '8408761477:AAFwnjuRxUxNkmj5xVemHzirdYxtbmtiNRc';
        const TELEGRAM_CHANNEL_ID = '-1002709853773';
        
        let currentTimezone = localStorage.getItem('wabblenews_timezone') || 'auto';
        let currentLanguage = localStorage.getItem('wabblenews_language') || 'auto';

        const translations = {
            en: { home: 'Home', contact: 'Contact', social: 'Social Media', calendar: 'Calendar', signup: 'Sign Up/Sign In', latest: 'Latest Crypto News', fastest: 'The fastest crypto and market news shared almost instantly.', loading: 'Loading latest news from Telegram...', noposts: 'No posts available. Check back soon!', error: 'Unable to load posts. Please refresh the page.', joinTitle: 'Join WabbleNews', joinSub: 'Create your account to stay updated with the latest crypto news', signIn: 'Sign In', welcomeBack: 'Welcome Back', signInSub: 'Sign in to your account', username: 'Username', password: 'Password', confirmPassword: 'Confirm Password', joinNow: 'Join Now', haveAccount: 'Have an account?', noAccount: "Don't have an account?", google: 'Continue with Google', or: 'or', comment: 'Comment' },
            tr: { home: 'Anasayfa', contact: 'letiim', social: 'Sosyal Medya', signup: 'Kayt/Giri', latest: 'Son Kripto Haberleri', fastest: 'En hzl kripto ve piyasa haberleri annda paylalyor.', loading: 'Telegram\'dan haberler ykleniyor...', noposts: 'Henz gnderi yok. Daha sonra tekrar kontrol edin!', error: 'Gnderiler yklenemedi. Ltfen sayfay yenileyin.', joinTitle: 'WabbleNews\'e Katl', joinSub: 'En son kripto haberlerinden haberdar olmak iin hesap oluturun', signIn: 'Giri Yap', welcomeBack: 'Tekrar Hogeldiniz', signInSub: 'Hesabnza giri yapn', username: 'Kullanc Ad', password: 'ifre', confirmPassword: 'ifre Tekrar', joinNow: 'imdi Katl', haveAccount: 'Hesabnz var m?', noAccount: 'Hesabnz yok mu?', google: 'Google ile Devam Et', or: 'veya' },
            zh: { home: '', contact: '', social: '', signup: '/', latest: '', fastest: '', loading: 'Telegram...', noposts: '', error: '', joinTitle: 'WabbleNews', joinSub: '', signIn: '', welcomeBack: '', signInSub: '', username: '', password: '', confirmPassword: '', joinNow: '', haveAccount: '', noAccount: '', google: 'Google', or: '' },
            ja: { home: '', contact: '', social: '', signup: '/', latest: '', fastest: '', loading: 'Telegram...', noposts: '', error: '', joinTitle: 'WabbleNews', joinSub: '', signIn: '', welcomeBack: '', signInSub: '', username: '', password: '', confirmPassword: '', joinNow: '', haveAccount: '', noAccount: '', google: 'Google', or: '' },
            ko: { home: '', contact: '', social: ' ', signup: '/', latest: '  ', fastest: '       .', loading: 'Telegram    ...', noposts: ' .   !', error: '   .  .', joinTitle: 'WabbleNews ', joinSub: '     ', signIn: '', welcomeBack: '   ', signInSub: ' ', username: ' ', password: '', confirmPassword: ' ', joinNow: ' ', haveAccount: ' ?', noAccount: ' ?', google: 'Google ', or: '' },
            ar: { home: '', contact: '', social: ' ', signup: '/', latest: '  ', fastest: '      .', loading: '     ...', noposts: '  .  !', error: '  .   .', joinTitle: '  WabbleNews', joinSub: '       ', signIn: ' ', welcomeBack: ' ', signInSub: '   ', username: ' ', password: ' ', confirmPassword: '  ', joinNow: ' ', haveAccount: ' ', noAccount: '  ', google: '  Google', or: '' },
            es: { home: 'Inicio', contact: 'Contacto', social: 'Redes Sociales', signup: 'Registrarse/Iniciar', latest: 'ltimas Noticias Cripto', fastest: 'Las noticias ms rpidas de criptomonedas y mercados compartidas al instante.', loading: 'Cargando ltimas noticias de Telegram...', noposts: 'No hay publicaciones disponibles. Vuelve pronto!', error: 'No se pueden cargar las publicaciones. Actualiza la pgina.', joinTitle: 'nete a WabbleNews', joinSub: 'Crea tu cuenta para estar al da con las ltimas noticias cripto', signIn: 'Iniciar Sesin', welcomeBack: 'Bienvenido de Nuevo', signInSub: 'Inicia sesin en tu cuenta', username: 'Usuario', password: 'Contrasea', confirmPassword: 'Confirmar Contrasea', joinNow: 'nete Ahora', haveAccount: 'Tienes cuenta?', noAccount: 'No tienes cuenta?', google: 'Continuar con Google', or: 'o' },
            fr: { home: 'Accueil', contact: 'Contact', social: 'Rseaux Sociaux', signup: 'Inscription/Connexion', latest: 'Dernires Actualits Crypto', fastest: 'Les actualits crypto et march les plus rapides partages instantanment.', loading: 'Chargement des dernires actualits de Telegram...', noposts: 'Aucune publication disponible. Revenez bientt!', error: 'Impossible de charger les publications. Veuillez rafrachir la page.', joinTitle: 'Rejoindre WabbleNews', joinSub: 'Crez votre compte pour rester inform des dernires actualits crypto', signIn: 'Se Connecter', welcomeBack: 'Bienvenue', signInSub: 'Connectez-vous  votre compte', username: 'Nom d\'utilisateur', password: 'Mot de passe', confirmPassword: 'Confirmer le Mot de passe', joinNow: 'Rejoindre', haveAccount: 'Vous avez un compte?', noAccount: 'Pas de compte?', google: 'Continuer avec Google', or: 'ou' },
            ru: { home: '', contact: '', social: '', signup: '/', latest: '  ', fastest: '      .', loading: '    Telegram...', noposts: ' .  !', error: '   .  .', joinTitle: '  WabbleNews', joinSub: '      ', signIn: '', welcomeBack: ' ', signInSub: '   ', username: ' ', password: '', confirmPassword: ' ', joinNow: '', haveAccount: ' ?', noAccount: ' ?', google: '  Google', or: '' }
        };

        function toggleDropdown(id) {
            const dropdown = document.getElementById(id);
            const menu = dropdown.querySelector('.dropdown-menu');
            document.querySelectorAll('.dropdown-menu').forEach(m => {
                if (m !== menu) m.classList.remove('active');
            });
            menu.classList.toggle('active');
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.settings-dropdown')) {
                document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('active'));
            }
        });

        function setTimezone(tz, display) {
            currentTimezone = tz;
            localStorage.setItem('wabblenews_timezone', tz);
            localStorage.setItem('wabblenews_timezone_display', display || 'Auto');
            document.getElementById('selectedTimezone').textContent = display || 'Auto';
            document.querySelectorAll('#timezoneMenu .dropdown-item').forEach(item => {
                item.classList.toggle('selected', item.dataset.tz === tz);
            });
            document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('active'));
            fetchTelegramPosts();
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('wabblenews_language', lang);
            const langNames = { en: 'English', tr: 'Trke', zh: '', ja: '', ko: '', ar: '', es: 'Espaol', fr: 'Franais', ru: '' };
            document.getElementById('selectedLanguage').textContent = langNames[lang] || 'English';
            document.querySelectorAll('#languageMenu .dropdown-item').forEach(item => {
                item.classList.toggle('selected', item.dataset.lang === lang);
            });
            document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('active'));
            applyTranslations(lang);
        }

        function applyTranslations(lang) {
            const t = translations[lang] || translations.en;
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.dataset.translate;
                if (t[key]) el.textContent = t[key];
            });
        }

        function getTimezone() {
            if (currentTimezone === 'auto') {
                return Intl.DateTimeFormat().resolvedOptions().timeZone;
            }
            return currentTimezone;
        }

        function removeEmojisExceptFlags(text) {
            return text.replace(/(?![\u{1F1E0}-\u{1F1FF}])[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F600}-\u{1F64F}]|[\u{1F680}-\u{1F6FF}]|[\u{1F900}-\u{1F9FF}]|[\u{1FA00}-\u{1FA6F}]|[\u{1FA70}-\u{1FAFF}]|[\u{231A}-\u{231B}]|[\u{23E9}-\u{23F3}]|[\u{23F8}-\u{23FA}]|[\u{25AA}-\u{25AB}]|[\u{25B6}]|[\u{25C0}]|[\u{25FB}-\u{25FE}]|[\u{2614}-\u{2615}]|[\u{2648}-\u{2653}]|[\u{267F}]|[\u{2693}]|[\u{26A1}]|[\u{26AA}-\u{26AB}]|[\u{26BD}-\u{26BE}]|[\u{26C4}-\u{26C5}]|[\u{26CE}]|[\u{26D4}]|[\u{26EA}]|[\u{26F2}-\u{26F3}]|[\u{26F5}]|[\u{26FA}]|[\u{26FD}]|[\u{2702}]|[\u{2705}]|[\u{2708}-\u{270D}]|[\u{270F}]|[\u{2712}]|[\u{2714}]|[\u{2716}]|[\u{271D}]|[\u{2721}]|[\u{2728}]|[\u{2733}-\u{2734}]|[\u{2744}]|[\u{2747}]|[\u{274C}]|[\u{274E}]|[\u{2753}-\u{2755}]|[\u{2757}]|[\u{2763}-\u{2764}]|[\u{2795}-\u{2797}]|[\u{27A1}]|[\u{27B0}]|[\u{27BF}]|[\u{2934}-\u{2935}]|[\u{2B05}-\u{2B07}]|[\u{2B1B}-\u{2B1C}]|[\u{2B50}]|[\u{2B55}]|[\u{3030}]|[\u{303D}]|[\u{3297}]|[\u{3299}]/gu, '');
        }

        function cleanTelegramText(text) {
            if (!text) return '';
            let cleaned = text;
            cleaned = cleaned.replace(/@cryptowabble/gi, '');
            cleaned = cleaned.replace(/@misuterminal/gi, '');
            cleaned = removeEmojisExceptFlags(cleaned);
            cleaned = cleaned.replace(/\n{3,}/g, '\n\n');
            cleaned = cleaned.trim();
            return cleaned;
        }

        function formatDateTime(timestamp) {
            const tz = getTimezone();
            const date = new Date(timestamp * 1000);
            const dateStr = date.toLocaleDateString('en-US', { timeZone: tz, month: 'long', day: 'numeric', year: 'numeric' });
            const timeStr = date.toLocaleTimeString('en-US', { timeZone: tz, hour: '2-digit', minute: '2-digit', hour12: true });
            return { date: dateStr, time: timeStr };
        }

        function getRelativeTime(timestamp) {
            const now = Date.now();
            const postTime = timestamp * 1000;
            const diff = now - postTime;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            const weeks = Math.floor(diff / 604800000);
            const months = Math.floor(diff / 2592000000);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return minutes + ' minute' + (minutes > 1 ? 's' : '') + ' ago';
            if (hours < 24) return hours + ' hour' + (hours > 1 ? 's' : '') + ' ago';
            if (days < 7) return days + ' day' + (days > 1 ? 's' : '') + ' ago';
            if (weeks < 4) return weeks + ' week' + (weeks > 1 ? 's' : '') + ' ago';
            return months + ' month' + (months > 1 ? 's' : '') + ' ago';
        }

        function createMediaGrid(media) {
            if (!media || media.length === 0) return '';
            const count = Math.min(media.length, 4);
            let html = '<div class="news-card-media"><div class="media-grid grid-' + count + '">';
            media.slice(0, 4).forEach((item, i) => {
                html += '<div class="media-item">';
                if (item.type === 'video') {
                    html += '<video src="' + item.url + '" muted loop playsinline></video>';
                    html += '<div class="video-indicator"><i data-lucide="play" class="w-6 h-6"></i></div>';
                } else {
                    html += '<img src="' + item.url + '" alt="News" loading="lazy" onerror="this.parentElement.style.display=\'none\'">';
                }
                html += '</div>';
            });
            html += '</div></div>';
            return html;
        }

        function createNewsCard(post) {
            const card = document.createElement('div');
            card.className = 'news-card' + (post.media.length === 0 ? ' news-card-no-image' : '');
            const dt = formatDateTime(post.date);
            const relTime = getRelativeTime(post.date);
            let html = createMediaGrid(post.media);
            html += '<div class="news-card-content">';
            html += '<div class="news-card-meta">';
            html += '<span class="news-card-date">' + dt.date + '</span>';
            html += '<span class="news-card-time-separator"></span>';
            html += '<span class="news-card-exact-time">' + dt.time + '</span>';
            html += '<span class="news-card-relative-time">' + relTime + '</span>';
            html += '</div>';
            html += '<p class="news-card-title">' + post.text + '</p>';
            html += '<div class="news-card-actions">';
            html += '<a href="comments.html?post=' + post.id + '" class="comment-btn" onclick="handleCommentClick(event, ' + post.id + ')"><svg class="comment-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg><span>Comments</span></a>';
            html += '</div>';
            html += '</div>';
            card.innerHTML = html;
            card.addEventListener('mouseenter', () => {
                const video = card.querySelector('video');
                if (video) video.play();
            });
            card.addEventListener('mouseleave', () => {
                const video = card.querySelector('video');
                if (video) { video.pause(); video.currentTime = 0; }
            });
            return card;
        }

        // Store posts for comments page
        let allPosts = [];

        function handleCommentClick(e, postId) {
            e.preventDefault();
            e.stopPropagation();
            // Save post data for comments page
            const post = allPosts.find(p => p.id === postId);
            if (post) {
                localStorage.setItem('wabblenews_current_post', JSON.stringify(post));
            }
            const currentUser = localStorage.getItem('wabblenews_current_user');
            if (!currentUser) {
                openAuthModal('signup');
            } else {
                window.location.href = 'comments.html?post=' + postId;
            }
        }

        function checkPasswordStrength(password) {
            const bars = [document.getElementById('bar1'), document.getElementById('bar2'), document.getElementById('bar3'), document.getElementById('bar4'), document.getElementById('bar5')];
            const label = document.getElementById('strengthLabel');
            const container = document.getElementById('passwordStrength');
            
            if (!password) {
                bars.forEach(b => b.classList.remove('active'));
                label.textContent = '';
                container.className = 'password-strength';
                return;
            }
            
            let score = 0;
            if (password.length >= 8) score++;
            if (password.length >= 12) score++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) score++;
            if (/\d/.test(password)) score++;
            if (/[^a-zA-Z0-9]/.test(password)) score++;
            
            const levels = ['', 'weak', 'normal', 'strong', 'verystrong', 'incredible'];
            const labels = ['', 'Weak', 'Normal', 'Strong', 'Very Strong', 'Incredible'];
            
            bars.forEach((bar, i) => {
                bar.classList.toggle('active', i < score);
            });
            
            container.className = 'password-strength strength-' + levels[score];
            label.textContent = labels[score];
        }

        async function getFileUrl(fileId) {
            try {
                const resp = await fetch('https://api.telegram.org/bot' + TELEGRAM_BOT_TOKEN + '/getFile?file_id=' + fileId);
                const data = await resp.json();
                if (data.ok && data.result.file_path) {
                    return 'https://api.telegram.org/file/bot' + TELEGRAM_BOT_TOKEN + '/' + data.result.file_path;
                }
            } catch (e) { console.log('File fetch error'); }
            return null;
        }

        async function fetchTelegramPosts() {
            const feedContainer = document.getElementById('telegram-feed');
            if (!feedContainer) return;

            try {
                const response = await fetch('https://api.telegram.org/bot' + TELEGRAM_BOT_TOKEN + '/getUpdates?allowed_updates=["channel_post"]&limit=100');
                if (!response.ok) throw new Error('Failed to fetch');
                const data = await response.json();
                if (!data.ok) throw new Error('API error');
                
                const postsMap = new Map();
                
                if (data.result && data.result.length > 0) {
                    for (const update of data.result) {
                        const post = update.channel_post || update.message;
                        if (!post) continue;
                        
                        const text = post.text || post.caption || '';
                        if (text.toLowerCase().includes('@misuterminal')) continue;
                        
                        const mediaGroupId = post.media_group_id;
                        const msgId = mediaGroupId || post.message_id;
                        
                        let mediaItem = null;
                        if (post.photo && post.photo.length > 0) {
                            const largest = post.photo[post.photo.length - 1];
                            const url = await getFileUrl(largest.file_id);
                            if (url) mediaItem = { type: 'photo', url };
                        } else if (post.video) {
                            const url = await getFileUrl(post.video.file_id);
                            if (url) mediaItem = { type: 'video', url };
                        } else if (post.animation) {
                            const url = await getFileUrl(post.animation.file_id);
                            if (url) mediaItem = { type: 'video', url };
                        }
                        
                        if (postsMap.has(msgId)) {
                            const existing = postsMap.get(msgId);
                            if (mediaItem) existing.media.push(mediaItem);
                            if (!existing.text && text) existing.text = cleanTelegramText(text);
                        } else {
                            const cleanedText = cleanTelegramText(text);
                            postsMap.set(msgId, {
                                id: msgId,
                                text: cleanedText,
                                date: post.date,
                                media: mediaItem ? [mediaItem] : []
                            });
                        }
                    }
                }
                
                const newPosts = Array.from(postsMap.values()).filter(p => p.text);
                
                // Load stored posts from localStorage and merge with new posts (PERMANENT STORAGE)
                let storedPosts = [];
                try {
                    const stored = localStorage.getItem('wabblenews_posts');
                    if (stored) storedPosts = JSON.parse(stored);
                } catch(e) { storedPosts = []; }
                
                // Merge: add new posts that don't exist in stored posts
                const existingIds = new Set(storedPosts.map(p => p.id));
                for (const post of newPosts) {
                    if (!existingIds.has(post.id)) {
                        storedPosts.push(post);
                    }
                }
                
                // Sort by date (newest first) and save permanently
                storedPosts.sort((a, b) => b.date - a.date);
                localStorage.setItem('wabblenews_posts', JSON.stringify(storedPosts));
                
                // Store posts globally for comments page
                allPosts = storedPosts;
                
                if (storedPosts.length === 0) {
                    const t = translations[currentLanguage] || translations.en;
                    feedContainer.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-gray-400 font-bold">' + t.noposts + '</p></div>';
                    return;
                }
                
                feedContainer.innerHTML = '';
                storedPosts.slice(0, 100).forEach(post => {
                    feedContainer.appendChild(createNewsCard(post));
                });
                lucide.createIcons();
            } catch (error) {
                console.error('Error:', error);
                const t = translations[currentLanguage] || translations.en;
                feedContainer.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-gray-400 font-bold">' + t.error + '</p></div>';
            }
        }

        function initSettings() {
            const savedTz = localStorage.getItem('wabblenews_timezone');
            const savedLang = localStorage.getItem('wabblenews_language');
            if (savedTz) setTimezone(savedTz);
            if (savedLang && savedLang !== 'auto') setLanguage(savedLang);
            else {
                const browserLang = navigator.language.split('-')[0];
                if (translations[browserLang]) setLanguage(browserLang);
            }
        }

        initSettings();
        fetchTelegramPosts();
        setInterval(fetchTelegramPosts, 60000);
    </script>
</body>
</html>
